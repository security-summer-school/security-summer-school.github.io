#include <stdio.h>
#include <stdlib.h>
#include <sys/mman.h>
#include <string.h>

unsigned char a[] = {
255, 226, 35, 79, 43, 85, 147, 175, 170, 170, 223, 168, 99, 105, 226, 155, 106, 226, 155, 85, 226, 155, 120, 204, 21, 171, 170, 24, 155, 226, 39, 159, 184, 170, 170, 170, 26, 171, 165, 175, 226, 155, 106, 226, 109, 109, 85, 85, 85, 85, 26, 150, 165, 175, 249, 251, 255, 235, 235, 235, 233, 225, 139, 139, 139, 138, 255, 218, 138, 222, 197, 138, 196, 197, 138, 205, 197, 197, 206, 138, 203, 205, 203, 195, 196, 134, 138, 207, 194, 149, 138, 249, 251, 255, 235, 235, 235, 233, 225, 139, 139, 139, 170, 160
};

unsigned char b[] = {
255, 226, 35, 79, 43, 85, 244, 96, 157, 185, 223, 168, 99, 105, 226, 155, 106, 226, 155, 85, 226, 155, 120, 204, 21, 171, 170, 24, 155, 226, 39, 159, 184, 170, 170, 170, 26, 171, 165, 175, 226, 155, 106, 226, 109, 109, 85, 85, 85, 85, 26, 150, 165, 175, 249, 251, 255, 235, 235, 235, 233, 225, 139, 139, 139, 138, 255, 218, 138, 222, 197, 138, 196, 197, 138, 205, 197, 197, 206, 138, 203, 205, 203, 195, 196, 134, 138, 207, 194, 149, 138, 249, 251, 255, 235, 235, 235, 233, 225, 139, 139, 139, 170, 160
};

unsigned char c[] = {
255, 226, 35, 79, 43, 85, 69, 20, 7, 116, 223, 168, 99, 105, 35, 82, 34, 104, 42, 88, 164, 34, 123, 42, 91, 122, 223, 183, 204, 35, 104, 204, 107, 64, 162, 106, 64, 174, 92, 120, 42, 88, 89, 223, 166, 35, 104, 107, 64, 186, 204, 43, 80, 7, 116, 222, 130, 226, 155, 106, 226, 155, 85, 226, 155, 120, 204, 21, 171, 170, 24, 155, 226, 39, 159, 135, 170, 170, 170, 26, 171, 165, 175, 226, 155, 106, 226, 109, 109, 85, 85, 85, 85, 26, 150, 165, 175, 226, 155, 106, 226, 155, 85, 226, 155, 120, 226, 39, 159, 151, 170, 170, 170, 226, 109, 104, 162, 170, 170, 170, 165, 175, 85, 188, 249, 251, 255, 235, 235, 235, 233, 225, 139, 139, 139, 138, 255, 218, 138, 222, 197, 138, 196, 197, 138, 205, 197, 197, 206, 138, 203, 205, 203, 195, 196, 134, 138, 207, 194, 149, 138, 249, 251, 255, 235, 235, 235, 233, 225, 139, 139, 139, 170, 160, 170, 170, 170, 170, 170, 170, 170, 170
};

void xor(unsigned char* buf, int len)
{
	unsigned int i = 0;

	for (i = 0; i < len; i++) {
		buf[i] ^= 0xaa;
	}
}

void get_shell()
{
	system("/bin/sh");
}

void f(char* buf)
{
	fgets(buf, 70, stdin);
	fflush(stdin);
}

int main(int argc, char* argv[])
{
        setvbuf(stdin, NULL, _IONBF, 0);
        setvbuf(stdout, NULL, _IONBF, 0);

	/* has to be 0xdeadc0de for secret */
	int hum = 0xdeadbeef;
	int mag = 0x1337ca5e;
	int par = 1337;
	char buf[40];

	f(buf);

	void (*g)(int);

	g = mmap(NULL, 4096, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);
	xor(a, sizeof(a));
	memcpy(g, &a, sizeof(a));
	g(par);
	fflush(stdin);

	xor(b, sizeof(b));
	memcpy(g, &b, sizeof(b));
	g(mag);
	fflush(stdin);

	xor(c, sizeof(c));
	memcpy(g, &c, sizeof(c));
	g(hum);
	fflush(stdin);

	return 0;
}
