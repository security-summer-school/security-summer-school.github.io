<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.85.0"><link rel=canonical type=text/html href=/web/><link rel=alternate type=application/rss+xml href=/web/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Security Summer School</title><meta name=description content="SSS Web Security
This is the public repository for the Web Security track of the Security Summer School (SSS).
It contains information available to …"><meta property="og:title" content><meta property="og:description" content="A free Security Summer School focused on security essentials, binary exploitation and web security."><meta property="og:type" content="website"><meta property="og:url" content="/web/"><meta property="og:site_name" content="Security Summer School"><meta itemprop=name content><meta itemprop=description content="A free Security Summer School focused on security essentials, binary exploitation and web security."><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="A free Security Summer School focused on security essentials, binary exploitation and web security."><link rel=preload href=/scss/main.min.959cc3579647d04265a1bb70b679a0771e7f7f7050bd3a694c2edd07f32972ca.css as=style><link href=/scss/main.min.959cc3579647d04265a1bb70b679a0771e7f7f7050bd3a694c2edd07f32972ca.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-00000000-0','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Security Summer School</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/binary/><span>Binary Exploitation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/essentials/><span>Security Essentials</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/web/><span class=active>Web Security</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/web/>Return to the regular view of this page</a>.</p></div><h1 class=title></h1><ul><li>1: <a href=#pg-09fc36b6d03aacc7a5bf78018398472d></a></li><li>2: <a href=#pg-ad6229ac83952aee3cad201564d38029></a></li><li>3: <a href=#pg-6d3ea5280422db131d38d303e9ab2bdd></a></li><li>4: <a href=#pg-e8a4b127c58a39d643c27e9bb530772d></a></li><li>5: <a href=#pg-fca1ee26cbdcd099d45b25d743b89e27></a></li><li>6: <a href=#pg-cd5bf7687b4a925bb14ff76ea1daabd5></a></li><li>7: <a href=#pg-3c989ecc31723db021aeba7cbe908787></a></li><li>8: <a href=#pg-9487404c736db9fa8f9337d1c0a562ec></a></li><li>9: <a href=#pg-f03e24906eb542d936ae967261b84e88></a></li></ul><div class=content><h1 id=sss-web-security>SSS Web Security</h1><p>This is the public repository for the <strong>Web Security</strong> track of the Security Summer School (SSS).
It contains information available to participants: session content, slides, activities support files.
Apart from SSS participants, you can use this content by yourself to learn more about <strong>Web Security</strong>.</p><h2 id=using-the-content>Using the Content</h2><p>As with all SSS tracks, the <strong>Web Security</strong> track consists of multiple sessions.
One session typically covers a particular topic of the track.
Ideally you would go through the sessions orderly, but you can jump ahead to a topic of interest.</p><p>Each session has its own folder.
The <code>index.md</code> file from a session folder details the topic of the session and includes practical demos of tools and snippets of code.</p><p>After reading the session contents, jump to the hands-on activities.
A typical activity will challenge you to solve / exploit a given issue and obtain a flag.
Read the activity description in the session contents and then use the activity support file to get to a solution.
Each activity will develop your practical skills and help you get a better understanding of the session topics.</p><p>Activities come in two forms:</p><ul><li><strong>tutorials</strong>: that provide a step-by-step detailing of the solution.</li><li><strong>challenges</strong>: that only state the goal and provide an initial skeleton (and maybe some hints), then the rest is up to you.
Even so, challenge activity folders store the reference solution for you to take a sneak peak in case you&rsquo;re lost.</li></ul><h2 id=support>Support</h2><p>In case you have questions or want to know more about a topic, use the the <code>Discussions</code> tab or join the <a href=https://discord.gg/qx3RmNEVkB>SSS Discord community</a>.</p><h3 id=session-folder-structure>Session Folder Structure</h3><p>A session folder consists of:</p><ul><li><code>index.md</code>: session contents, written in <a href=https://guides.github.com/features/mastering-markdown/>GitHub Markdown</a></li><li><code>activities/</code>: each activity has its own folder with support files (including the reference solution)</li><li><code>assets/</code>: support files for session contents (images, diagrams, code snippets, packet captures, etc.)</li><li><code>slides/</code>: session slides</li></ul><h3 id=activity-folder-structure>Activity Folder Structure</h3><p>An activity folder consists of:</p><ul><li><code>public/</code>: support file for the activity: binary files, helper scripts, packet captures etc.</li><li><code>sol/</code>: the reference solution of the activity.
Tutorial activities feature a <code>README.md</code> file in the solution folder, with a detailing of the solution.</li></ul><h2 id=contributing>Contributing</h2><p>Contributions are welcome.
See the <a href=CONTRIBUTING.md>contribution guide</a> on how you could report or fix issues and on how you can improve the content.</p><p>Reviewers are requested to follow the <a href=REVIEWING.md>reviewing guide</a>.</p><p>For in-depth discussions, please join the <a href=https://discord.gg/qx3RmNEVkB>SSS Discord community</a>.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-09fc36b6d03aacc7a5bf78018398472d>1 -</h1><h1 id=introduction>Introduction</h1><hr><p>As the World Wide Web&rsquo;s high-level topology consists mainly of personal computing devices (e.g. desktops, laptops, mobile devices) making HTTP requests to web servers, the general field of web security consists of three main sub-fields: client-side security (i.e. browser security), communications security and server-side security, or web application security.
This lab and the following will focus on the first sub-field, although they might provide some general information on the former two.</p><p>The design of web applications, and their security in particular is influenced by the following characteristics:</p><ul><li><p><strong>Statelessness:</strong> by default HTTP is a simple request-response protocol maintaining no state between successive communications.
This shortcoming led to the design of cookies, which are small pieces of information exchanged between the client and the web application.
The type of information exchanged using cookies needs to be carefully chosen, as a malicious client could possibly attempt to send back a malformed or forged cookie; additionally, cookies most often (but not always) represent confidential data, which means that they should only be transferred over a secure channel (i.e. HTTPS).</p></li><li><p><strong>Message format:</strong> HTTP requests have a specific format, namely they comprise plain-text header and data (although newer improvements also implement a binary protocol).
The header contains various information about the client or the server (e.g. a user-agent, page caching information, text encoding information), while the payload is very often (but not always) an HTML page.</p></li><li><p><strong>Addressing:</strong> resources on the web are located using the URI/URL addressing scheme.
Possible vulnerabilities here include a misconfigured web server that allows viewing application-specific files, or worse, that allows accessing other files on the host machine.
While this information leakage is not very dangerous by itself, it may be used as an intermediary stage for other attacks.
You can read more about URLs here <a href=https://skorks.com/2010/05/what-every-developer-should-know-about-urls/>[1]</a>.</p></li><li><p><strong>Request methods:</strong> HTTP communication is done by using methods, also called HTTP verbs.
The most used methods are GET, POST, PUT and DELETE.
The GET method is read-only and is used to retrieve data from the server.
A DELETE request is used to remove the specified resource from the server.
The PUT method is used to modify an entire resource.
POST requests are used to create new resources.
You can find more information about all methods here <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods>[2]</a>.</p></li></ul><p>While the client is provided with HTML, JavaScript, CSS pages, modern web applications are implemented using general-purpose scripting or programming languages, e.g. PHP, Java, Python, Ruby, etc. and centralize their data using database systems such as MySQL.
Faulty back-end code can in itself provide a more dangerous attack surface to potentially malicious clients.</p><p><img src=./assets/Session_01_Web_Basics_Diagram_01.jpg alt="Client - Server"></p><h1 id=web-applications-today>Web Applications Today</h1><p>Dynamic websites provide tailored user experiences based on information known or given by the user.
The user usually has to authenticate to access the website and is authorized to use the services it provides.
In this case, the dynamic website contains information about the user, and there is therefore a great deal more for the attacker to steal.
The fundamental difference to static web pages is that a dynamic webpage/website contains functionality that can be compromised.
Breaching the security of the server itself is no longer necessary. It is sufficient to discover the security hole in the dynamic website functionality.
We, therefore, need to look at the security of a web application itself. A dynamic website can be considered to be a web application.</p><p>Web applications introduce a new range of threats, or a new security perimeter, to put it another way.
Depending on the setup, web applications are commonly located in an internal network or in the demilitarized zone, which therefore renders network level defenses ineffective.
Network, services and operating system level defenses may have been perfectly set in place, but the system would still be vulnerable to a break-in.
Web applications commonly interact with internal systems, such as database servers.
The network level firewall could be blocking all traffic, but for web applications, it will have to allow HTTP and HTTPS traffic.
An attacker might therefore be able to bypass all network-level defenses.</p><h1 id=types-of-vulnerabilities>Types of Vulnerabilities</h1><p>These days, web applications are very complex being composed of multiple libraries, frameworks and using multiple external services.
Each component can have vulnerabilities.
Types of vulnerabilities:</p><ul><li>System vulnerabilities - applications or services that run inside an Operating System or an Operating System vulnerability</li><li>Runtime vulnerabilities - when one of the components (frameworks such as PHP, Java, Python, WordPress, etc.) of the web application is vulnerable leads to a risk.</li><li>Browser vulnerabilities - occasionally attackers will discover a vulnerability in the browser itself that allows execution of arbitrary binary code when a user simply visits a compromised site.
Browsers are complex pieces of machinery with many subsystems (HTML rendering, JavaScript engine, CSS parser, image parsers, etc.), and a small coding mistake in any of these systems could offer malicious code just enough of a foothold to get running.</li><li>Vulnerabilities in web application implementation - here we can talk about OWASP Top Ten vulnerabilities <a href=https://owasp.org/www-project-top-ten/>[3]</a>.</li></ul><h1 id=http-hypertext-transfer-protocol>HTTP (Hypertext Transfer Protocol)</h1><h2 id=http-request--response>HTTP Request / Response</h2><p>Communication between clients and servers is done by requests and responses:</p><ul><li>A client (a browser) sends an HTTP request to the web</li><li>An web server receives the request</li><li>The server runs an application to process the request</li><li>The server returns an HTTP response (output) to the browser</li><li>The client (the browser) receives the response</li></ul><p><img src=./assets/http-request.png alt="HTTP - Request"></p><p><img src=./assets/http-response.png alt="HTTP - Response"></p><h3 id=basic-format-of-the-request>Basic format of the request:</h3><p>VERB /resource/locator HTTP/1.1<br>Header1: Value1<br>Header2: Value2<br>…</p><body of the request><p>Header is separated from the body by 2 CRLF sequences</p><h3 id=request-headers>Request Headers:</h3><ul><li><strong>Host:</strong> Indicates the desired host handling the request</li><li><strong>Accept:</strong> Indicates what MIME type(s) are accepted by the client; often used to specify JSON or XML output for web-services</li><li><strong>Cookie:</strong> Passes cookie data to the server</li><li><strong>Referer:</strong> Page leading to this request (note: this is not passed to other servers when using HTTPS on the origin)</li><li><strong>Authorization:</strong> Used for basic auth pages (mainly). Takes the form “Basic &lt;base64’d username:password>”</li></ul><h3 id=http-request-circle>HTTP Request Circle</h3><p>A typical HTTP request / response circle:</p><ol><li>The browser requests an HTML page. The server returns an HTML file.</li><li>The browser requests a style sheet. The server returns a CSS file.</li><li>The browser requests a JPEG image. The server returns a JPG file.</li><li>The browser requests JavaScript code. The server returns a JS file</li><li>The browser requests data. The server returns data (in XML or JSON).</li></ol><h3 id=xhr---xmlhttprequest>XHR - XMLHttpRequest</h3><p>All browsers have a built-in XMLHttpRequest Object (XHR).
XHR is a JavaScript object that is used to transfer data between a web browser and a web server.
XHR is often used to request and receive data for the purpose of modifying a web page.
Despite the XML and HTTP in the name, XHR is used with other protocols than HTTP, and the data can be of many different types like HTML, CSS, XML, JSON, and plain text.</p><p>The XHR Object is a Web Developers Dream, because you can:</p><ul><li>Update a web page without reloading the page</li><li>Request data from a server - after the page has loaded</li><li>Receive data from a server - after the page has loaded</li><li>Send data to a server - in the background</li></ul><p>The XHR Object is the underlying concept of AJAX and JSON:</p><p><img src=./assets/xml_http_request.png alt=XMLHttpRequest></p><h3 id=http-response-codes>HTTP Response Codes</h3><ul><li>1xx -> Informational responses</li><li>2xx -> Successful responses</li><li>3xx -> Redirects</li><li>4xx -> Client errors</li><li>5xx -> Server errors</li></ul><p>xx = [00, 01 … 99]</p><h3 id=url-uniform-resource-locator>URL (Uniform Resource Locator)</h3><p>With Hypertext and HTTP, URL is one of the key concepts of the Web.
It is the mechanism used by browsers to retrieve any published resource on the web.</p><p>URL stands for Uniform Resource Locator.
A URL is nothing more than the address of a given unique resource on the Web.
In theory, each valid URL points to a unique resource.
Such resources can be an HTML page, a CSS document, an image, etc.
In practice, there are some exceptions, the most common being a URL pointing to a resource that no longer exists or that has moved.
As the resource represented by the URL and the URL itself are handled by the Web server, it is up to the owner of the web server to carefully manage that resource and its associated URL.</p><p>A URL incorporates the domain name, along with other detailed information, to create a complete address (or “web address”) to direct a browser to a specific page online called a web page.
In essence, it’s a set of directions and every web page has a unique one.</p><p><img src=./assets/url.png alt=URL></p><p>Special characters are encoded as hex:</p><ul><li><strong>%0A</strong> = newline</li><li><strong>%20</strong> or + = space, <strong>%2B</strong> = + (special exception)</li></ul><h1 id=browser>Browser</h1><p>A web browser (commonly referred to as a browser) is a software application for accessing the information on the World Wide Web.
When a user requests a web page from a particular website, the web browser retrieves the necessary content from a web server and then displays the page on the screen.</p><p>A list of Web Browsers: Google Chrome, Mozilla Firefox, Edge, Internet Explorer, Safari, Opera, Netscape, etc.</p><h2 id=browser-execution-model>Browser execution model</h2><p>Each browser windows or frame:</p><ul><li>Loads content</li><li>Renders it<ul><li>Processes HTML and scripts to display page</li><li>May involve images, subframes, etc.</li></ul></li><li>Responds to events such as:<ul><li>User actions: OnClick, OnMouseover</li><li>Rendering: OnLoad, OnBeforeUnload</li><li>Timing: setTimeout(), clearTimeout()</li></ul></li></ul><p><img src=./assets/browser-analogy.png alt=browser-analogy></p><p>Examples of browser vulnerabilities:</p><ul><li>Google Chrome<ul><li>CVE-2019-5795 <a href=https://nvd.nist.gov/vuln/detail/CVE-2019-5795>https://nvd.nist.gov/vuln/detail/CVE-2019-5795</a></li></ul></li><li>Mozilla Firefox<ul><li>CVE-2019-11716 <a href=https://nvd.nist.gov/vuln/detail/CVE-2019-11716>https://nvd.nist.gov/vuln/detail/CVE-2019-11716</a></li></ul></li></ul><h1 id=developer-tools>Developer Tools</h1><p>Modern browsers, such as Google Chrome, Mozilla Firefox and Microsoft Edge, include some functionality aimed at developers for easier debugging, testing and previews.
Anyone can use these tools to look at the internals of a web page.
As a security professional, or even a hobbyist, these instruments provide you with insightful information about the inner workings of any web application out there.
Even if it can only show the front-end code, it can create an overview of the structure and maybe reveal valuable details, such as the traffic sent from and received by the client.</p><p>In order to open these tools, you can press <em>F12</em> while navigating a web page in any browser mentioned, or by using <em>Mouse Right Click</em> and selecting the Inspect Element option.
The latter lets you select which part of the page should be in focus when inspected.</p><p>Alternatively, you can see the entire HTML code of a web page by selecting View Page Source in the Mouse Right Click context menu.</p><p>Next, some of the core functionalities of these tools will be detailed (some names may vary slightly across browsers, but the functionality is mainly the same, so we will focus in Google Chrome here):</p><ul><li><strong>Elements</strong>: In this tab you can see the HTML structure of the page. On the right panel, you can see the styles applied to each element when selected and add, remove or edit the properties directly from there.
This kind of inspection could lead to the discovery of hidden elements which can be toggled into view by altering the CSS code or could lead to the discovery of commented pieces of code which could contain sensitive data.
Also, the <a href=#dom-document-object-model>DOM</a> (Document Object Model) structure of the page can be altered, and elements can be added or removed, such as scripts, input fields, etc. (any element in fact), which means that any JavaScript code used to sanitize user input or perform other functions can be bypassed.</li></ul><p><img src=./assets/devtools-1.png alt="Elements - Developer Tools"></p><ul><li><strong>Console</strong>: The console prints errors which occurred during page rendering or during any action performed on the page, such as, but not limited to, error loading an image not found, error while performing an asynchronous request to fetch data, missing included file (such as CSS or Javascript files), errors in Javascript code from the included scripts, debug messages left by the developer, etc.
The console also has the ability to run any Javascript code by typing it directly there and interacting with the page.</li></ul><p><img src=./assets/devtools-2.png alt="Console - Developer Tools"></p><ul><li><strong>Sources</strong>: This tab lets you see any file loaded in the front-end, such as images, JS, CSS etc. in an arborescent way.
This could be a good tool to inspect the JS scripts included in the current page.
They could reveal possibly valuable information, such as hidden paths or resources, or even critical pieces of functionality, which, if understood, could lead to successful exploits.</li></ul><p><img src=./assets/devtools-3.png alt="Sources - Developer Tools"></p><ul><li><strong>Network</strong>: The network tab shows detailed information about every file loaded and every request and response made by the page.
You can find in-depth info about the <a href=#http-hypertext-transfer-protocol>HTTP requests</a>, such as HTTP parameters, HTTP methods (GET, POST), HTTP status codes (200, 404, 500, etc.), loading time and size of each loaded element (image, script, etc).
Furthermore, clicking on one of the requests there, you can see the headers, the preview, the response (as raw content) and others.
This is useful for listing all the resources needed by a page, such as if there are any requests to APIs, additional scripts loaded, etc.</li></ul><p><img src=./assets/devtools-4.png alt="Network - Developer Tools"></p><ul><li><strong>Application</strong>: This tab lets you see some specific data about the page, such as cookies (which will be covered in depth in the next section), local storage, session storage, cache, etc.
This can be useful to see which data is stored on the client-side and it may contain useful values.</li></ul><p><img src=./assets/devtools-5.png alt="Application - Developer Tools"></p><ul><li><strong>Security</strong>: Detailed information about the protocol used (HTTP or HTTPS) and the website certificates.
Insecure websites can be vulnerable because HTTP sends data in plain text across the connection, which may be intercepted (e.g. Man in the Middle).</li></ul><p><img src=./assets/devtools-6.png alt="Security - Developer Tools"></p><h1 id=dom-document-object-model>DOM (Document Object Model)</h1><p>The Document Object Model connects web pages to scripts or programming languages by representing the structure of a document, such as the HTML representing a web page, in memory.
Usually, that means JavaScript, although modeling HTML, SVG, or XML documents as objects are not part of the core JavaScript language, as such.</p><p>Object-oriented interface used to read and write docs</p><ul><li>Web page in HTML in structured data</li><li>DOM provides a representation of this hierarchy</li></ul><p>The DOM represents a document with a logical tree. Each branch of the tree ends in a node, and each node contains objects.
DOM methods allow programmatic access to the tree. With them, you can change the document&rsquo;s structure, style, or content.</p><p>Nodes can also have event handlers attached to them. Once an event is triggered, the event handlers get executed.
DOM is an application programming interface.
Use the DOM when we interact with web pages.</p><ul><li>Add content to a HTML document</li><li>Delete content from a HTML document</li><li>Change Content on a HTML document</li></ul><p>Every element within your document is an object: &lt;head> tag, &lt;body> tag, etc.
In javascript we can call methods on objects, we can call properties on objects in order to change the objects.</p><p><img src=./assets/dom.png alt=DOM></p><p>We can introduce nodes, all objects are nodes.
We can change the nodes, we can interact with them, create Animations, validations, etc.</p><p>The Document interface represents any web page loaded in the browser and serves as an entry point into the web page&rsquo;s content, which is the DOM tree.
The DOM tree includes elements such as body and table, among many others.
It provides functionality globally to the document, like how to obtain the page&rsquo;s URL and create new elements in the document.</p><p><strong>DOM</strong></p><ul><li>Object-oriented interface used to read and write docs</li><li>Web page in HTML is structured data</li><li>DOM provides a representation of this hierarchy</li></ul><p><strong>Examples</strong></p><ul><li>Properties: document.alinkColor, document.URL, document.forms<input disabled type=checkbox> , document.links[], document.anchors<input disabled type=checkbox></li><li>Methods: document.write(document.referrer)</li></ul><p><strong>Includes Browser Object Model (BOM)</strong></p><ul><li>window, document, frames[], history, location, navigator (type
and version of the browser)</li></ul><h1 id=mime-multipurpose-internet-mail-extensions>MIME (Multipurpose Internet Mail Extensions)</h1><p>MIME is a specification for the format of non-text e-mail attachments that allows the attachment to be sent over the Internet.
MIME allows your mail client or Web browser to send and receive things like spreadsheets and audio, video and graphics files via Internet mail.
By default, many web servers are configured to report a MIME type of text/plain or application/octet-stream for unknown content types.
As new content types are invented or added to web servers, web administrators may fail to add the new MIME types to their web server&rsquo;s configuration.
This is a major source of problems for users of Gecko-based browsers, which respect the MIME types as reported by web servers and web applications.
Here you can find an example for this type of vulnerability. <a href=https://github.com/denimgroup/denimgroup-vulnerability-examples>[4]</a></p><p><strong>MIME Sniffing</strong> - The browser will often not just look at the Content-Type header that the server is passing, but also the contents of the page.
If it looks enough like HTML, it’ll be parsed as HTML. => This led to IE 6/7-era bugs where image and text files containing HTML tags would execute as HTML (not so common anymore).</p><p><strong>Encoding Sniffing</strong> - the encoding used on a document will be sniffed by browsers.
If you don’t specify an encoding for an HTML document, the browser will apply heuristics to determine it.
If you are able to control the way the browser decodes text, you may be able to alter the parsing.</p><h1 id=security-mechanism>Security Mechanism</h1><h2 id=isolation---frames-html-sandboxing>Isolation - Frames, HTML Sandboxing</h2><h3 id=frame-and-iframe>Frame and iFrame</h3><p>Windows may contain frames from different sources</p><ul><li>Frame: rigid division as part of frameset</li><li>iFrame: floating inline frame</li></ul><p>iFrame example:</p><pre><code>&lt;iframe src=&quot;simple_iframe.html&quot; width=450 height=100&gt;
if you can see this, your browser doesn't understand IFRAME.
&lt;/iframe&gt;
</code></pre><p><img src=./assets/browser-security-mechanism.png alt=BrowserSecurityMechanism></p><p>Why use frames?</p><ul><li>Delegate screen area to content from another source</li><li>Browser provides isolation based on frames</li><li>Parent may work even if frame is broken</li></ul><p>In order to play a little bit with iframes follow the next instructions:</p><ol><li><code>user@hostname~$: sudo apt install nginx</code></li><li>Change <code>index.html</code> file content with the above code</li><li><code>user@hostname~$: sudo service nginx start</code></li><li>Access the browser as http://localhost</li><li>Solve the problem in order to see the iframe</li></ol><p><img src=./assets/components-browser-security-policy.png alt=ComponentsBrowserSecurityPolicy></p><h3 id=html-sandboxing>HTML Sandboxing</h3><p>The sandbox attribute enables an extra set of restrictions for the content in the iframe.</p><p>When the sandbox attribute is present, and it will:</p><ul><li>treat the content as being from a unique origin</li><li>block form submission</li><li>block script execution</li><li>disable APIs</li><li>prevent links from targeting other browsing contexts</li><li>prevent content from using plugins (through &lt;embed>, &lt;object>, &lt;applet> or others)</li><li>prevent the content to navigate its top-level browsing context</li><li>block automatically triggered features (such as automatically playing a video or automatically focusing a form control)</li></ul><p>Add the below HTML code in the same index.html as above:</p><pre><code>&lt;iframe src=&quot;sandbox_iframe.html&quot; sandbox width=450 height=100&gt;
if you can see this, your browser doesn't understand SANDBOX IFRAME.
&lt;/iframe&gt;
</code></pre><p>Access the page via browser http://localhost.</p><p>The value of the sandbox attribute can either be just sandbox (then all restrictions are applied), or a space-separated list of predefined values that will REMOVE the particular restrictions.</p><h1 id=same-origin-policy>Same-origin Policy</h1><p>The same-origin policy is a critical security mechanism that restricts how a document or script loaded from one origin can interact with a resource from another origin.
It helps isolate potentially malicious documents, reducing possible attack vectors.</p><p>In order to understand how the policy works, you also need to understand what is an origin.
Two URLs have the same origin if the protocol, port (if specified), and host are the same for both.
To better understand this, follow the table below:</p><table><thead><tr><th>URL</th><th>Outcome</th><th>Reason</th></tr></thead><tbody><tr><td><a href=http://store.company.com/dir2/other.html>http://store.company.com/dir2/other.html</a></td><td>Same origin</td><td>Only the path differs</td></tr><tr><td><a href=http://store.company.com/dir/inner/another.html>http://store.company.com/dir/inner/another.html</a></td><td>Same origin</td><td>Only the path differs</td></tr><tr><td><a href=https://store.company.com/page.html>https://store.company.com/page.html</a></td><td>Failure</td><td>Different protocol</td></tr><tr><td><a href=http://store.company.com:81/dir/page.html>http://store.company.com:81/dir/page.html</a></td><td>Failure</td><td>Different port (http:// is port 80 by default)</td></tr><tr><td><a href=http://news.company.com/dir/page.html>http://news.company.com/dir/page.html</a></td><td>Failure</td><td>Different host</td></tr></tbody></table><h2 id=why-is-this-important>Why is this important?</h2><p>Assume you are logged into Facebook and visit a malicious website in another browser tab.
Without the same origin policy JavaScript on that website could do anything to your Facebook account that you are allowed to do.
For example read private messages, post status updates, analyse the HTML DOM-tree after you entered your password before submitting the form.</p><p>But of course Facebook wants to use JavaScript to enhance the user experience.
So it is important that the browser can detect that this JavaScript is trusted to access Facebook resources.
That&rsquo;s where the same origin policy comes into play: If the JavaScript is included from a HTML page on facebook.com, it may access facebook.com resources.</p><p>Now replace Facebook with your online banking website, and it will be obvious that this is an issue.</p><h2 id=is-this-always-the-case-to-access-only-resources-on-the-same-origin>Is this always the case, to access only resources on the same origin?</h2><p>The most prevalent myth about Same-origin Policy is that it plainly forbids a browser to load a resource from a different origin.
Though we know that the thing that makes today&rsquo;s web technologies so rich and colorful is the content loaded from different origins.
The presence of a huge content delivery network (CDN) ecosystem proves this is not true.</p><p>Another prevalent myth is that an origin cannot send information to another one.
That is also not true.
Again we know that an origin can make a request to another one.
The information of the forms in one origin can be reached from another origin.
If we think of cloud payment systems integrated into a business workflow, these often operate by sending requests to another origin.
Even one of the most common web vulnerabilities, Cross-Site Request Forgery (CSRF), arises from that point.
CSRF is possible because of the ability of sites to make requests to each other.
This topic will be covered in a separate session more in-depth.</p><h1 id=cors>CORS</h1><p>Cross-Origin Resource Sharing (CORS) is a mechanism that uses additional HTTP headers to tell browsers to give a web application running at one origin, access to selected resources from a different origin.
A web application executes a cross-origin HTTP request when it requests a resource that has a different origin (domain, protocol, or port) from its own.</p><p>An example of a cross-origin request: the front-end JavaScript code served from <a href=https://domain-a.com>https://domain-a.com</a> uses XMLHttpRequest (AJAX) to make a request for <a href=https://domain-b.com/data.json>https://domain-b.com/data.json</a>.</p><p>For security reasons, browsers restrict cross-origin HTTP requests initiated from scripts.
For example, XMLHttpRequest follows the same-origin policy.
This means that a web application using those APIs can only request resources from the same origin the application was loaded from unless the response from other origins includes the right CORS headers.</p><p>The CORS mechanism supports secure cross-origin requests and data transfers between browsers and servers.
Modern browsers use CORS in APIs such as XMLHttpRequest to mitigate the risks of cross-origin HTTP requests.
The CORS header is added by the server to the response.</p><p><strong>CORS Header Syntax:</strong><br><code>Access-Control-Allow-Origin: *</code><br><code>Access-Control-Allow-Origin: &lt;origin></code><br><code>Access-Control-Allow-Origin: null</code><br><code>Access-Control-Allow-Origin: https://developer.mozilla.org</code></p><p><img src=./assets/CORS.jpg alt=CORS></p><h1 id=talking-to-web-sites>Talking to web sites</h1><p>Let&rsquo;s go through the basics of how HTTP requests are made, using telnet to form requests. First, let&rsquo;s connect to the vulnerable web server:</p><pre><code>user@hostname~#: telnet 141.85.224.157 80
</code></pre><p>Now let&rsquo;s issue a simple GET.
The request is composed of:</p><ul><li>GET <path><http-version></li><li>followed by other header contents</li><li>followed by an additional newline, indicating the end of the request.</li></ul><p><em>Please note the above bullet points and the fact that you need to provide an additional newline to indicate the end of the request.</em></p><pre><code>GET / HTTP/1.0
</code></pre><pre><code>HEAD / HTTP/1.0
</code></pre><pre><code>POST / HTTP/1.0
</code></pre><p>The server&rsquo;s response contains:</p><ul><li>A status code (200 OK in our case)</li><li>Date information and information about the server</li><li>Encoding and other info about the data, i.e. it&rsquo;s MIME-type</li><li>The length of the data</li><li>The actual data</li></ul><h1 id=tools>Tools</h1><h2 id=postman>Postman</h2><p>Postman is a tool through which you can send HTTP requests.
It can automate tests and integrate them into CI/CD pipeline.
You can simulate endpoints to test without having to set up a backend.
It can also monitor certain endpoints to check their health and performance. <a href=https://www.postman.com/>[6]</a></p><h2 id=httpie>HTTPie</h2><p>HTTPie is also used to send HTTP requests.
It can be used in the terminal, instead of utilities such as <strong>curl</strong> and <strong>wget</strong>.
It has an easy syntax, comes with highlighting and JSON assets. <a href=https://httpie.io/>[7]</a></p><h2 id=hoppscotch>Hoppscotch</h2><p>Hoppscotch is a tool that you can use from your browser or as a browser extension to quickly test certain endpoints.
It also supports MQTT or GraphQL requests. <a href=https://hoppscotch.io/>[8]</a></p><h1 id=further-reading>Further Reading</h1><ul><li>[1] <a href=https://skorks.com/2010/05/what-every-developer-should-know-about-urls/>https://skorks.com/2010/05/what-every-developer-should-know-about-urls/</a></li><li>[2] <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods>https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods</a></li><li>[3] <a href=https://owasp.org/www-project-top-ten/>https://owasp.org/www-project-top-ten/</a></li><li>[4] <a href=https://github.com/denimgroup/denimgroup-vulnerability-examples>https://github.com/denimgroup/denimgroup-vulnerability-examples</a></li><li>[5] <a href=https://portswigger.net/web-security/cors/same-origin-policy>https://portswigger.net/web-security/cors/same-origin-policy</a></li><li>[6] <a href=https://www.postman.com/>https://www.postman.com/</a></li><li>[7] <a href=https://httpie.io/>https://httpie.io/</a></li><li>[8] <a href=https://hoppscotch.io/>https://hoppscotch.io/</a></li></ul><h1 id=activities>Activities</h1><p><strong>1.</strong> The below image represents a snippet with DevTools containing information about a web application.
What can you discover in the next image ?
Is there any useful information from a security point of view ?
Write the answer to the instructor.</p><p><img src=./assets/first-activity.png alt=FirstActivity></p><p><strong>2.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Cockroach</a><br><strong>3.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Gimme</a><br><strong>4.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Surprise</a><br><strong>5.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">My Special Name</a><br><strong>6.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Lame Login</a><br><strong>7.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Eyes</a><br><strong>8.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Name</a><br><strong>9.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Readme</a><br><strong>10.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">King-Kong</a><br><strong>11.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Give to Get</a><br><strong>12.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Give to Post</a><br><strong>13.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">One by One</a><br><strong>14.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Produce-consume</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-ad6229ac83952aee3cad201564d38029>2 -</h1><h1 id=introduction>Introduction</h1><p>In order to understand how to protect a web application, you need to understand how an attacker thinks.
And in order to do that, you need to understand how a platform is built and what techniques are used to ensure minimum usability.
As a first step, you can analyze web applications using readily available tools, such as the browser’s built-in Developer Tools.
Further on, you can attempt to find more information about the basic mechanisms that enable the server to identify its clients and keep tabs on who they are (authentication) and what they are allowed to do (authorization), through the use of cookies and sessions.</p><h1 id=stateful-http-cookies>Stateful HTTP: Cookies</h1><p>As we mentioned in the previous session, HTTP is a stateless protocol used to communicate over the internet.
This means that a request is not aware of any of the previous ones, and each request is executed independently.
Given its stateless nature, simple mechanisms such as HTTP cookies were created to overcome the issue.</p><p>An HTTP cookie (also called web cookie, Internet cookie, browser cookie, or simply cookie) is a small piece of data sent from a website and stored on the user&rsquo;s computer by the user&rsquo;s web browser while the user is browsing.
Cookies were designed to be a reliable mechanism for websites to remember stateful information (such as items added in the shopping cart in an online store) or to record the user&rsquo;s browsing activity (including clicking particular buttons, logging in, or recording which pages were visited in the past).
They can also be used to remember pieces of information that the user previously entered into form fields, such as names, addresses, passwords, and credit card numbers.</p><p><img src=./assets/cookies.png alt=Cookies></p><h2 id=what-is-a-cookie>What is a cookie?</h2><p>A cookie is a <em>key=value</em> pair stored in a text file on the user’s computer.
This file can be found, for example, at the following path on a Windows 10 using Chrome:</p><p><code>C:\Users\Your User Name\AppData\Local\Google\Chrome\User Data\Default\Cookies</code></p><p>An example of cookies set for a website could be:</p><ul><li>username=admin</li><li>cookie_consent=1</li><li>theme=dark</li></ul><p>The first cookie stores the username, so it can be displayed to the user without querying the database.
The second one stores the choice made by the user regarding the cookie consent, so the application would not continue to show the message every time.
Finally, the third one stores which theme was selected (in this case, a dark theme).</p><p>Once a cookie has been set, the browser will send the cookie information in all subsequent HTTP requests until the cookie is deleted.
Additionally, the cookie can have zero or more attributes, such as:</p><ul><li><em>Domain</em> and <em>Path</em> attributes define the scope of the cookies.
These attributes tell the browser what website they belong to.</li><li><em>Same origin policy</em> dictates that websites are only allowed to set cookies on their own domain.
In other words, the <code>www.example.com</code> website is not allowed to set cookies on <code>www.test.com</code> and vice versa.
A website is only able to control cookies that are within its own domain.</li><li>The <em>Expires</em> attribute defines when the cookie is deleted.
Alternatively, the Max-Age attribute can be used to state the number of seconds after the cookie is to be deleted.</li><li>The <em>Secure</em> attribute defines that cookies should only be sent using secure channels such as HTTPS.
Cookies with the Secure attribute should only be sent through a secure connection.
This protects the application&rsquo;s cookies against theft attempts.</li><li>The <em>http-only</em> attribute defines that cookie should be exposed only using HTTP or HTTPS channels.
This means that the cookies with this attribute cannot be accessed via client-side scripting or other methods.
This is a defense mechanism against <a href=https://owasp.org/www-community/HttpOnly>some attacks</a>.</li></ul><h1 id=stateful-http-sessions>Stateful HTTP: Sessions</h1><p>As previously stated, HTTP is stateless.
Therefore, it needs a mechanism to remember information from previous requests and associate it with a user for authentication purposes.
The cookies are one way to achieve this.
However, they are considered highly insecure because the user can easily manipulate their content.
We cannot directly use them for authentication and other sensitive data.
The solution to this problem is the session, which stores the data on the server, rather than the client.
The session ID can be used as a means of communication.</p><h2 id=how-does-a-session-work>How does a session work?</h2><p>When accessing a website that uses sessions, each user is assigned a session ID.
They are more secure than the previously mentioned method mainly because the data never leaves the server, so an attacker cannot alter it.
Instead, the ID is used to uniquely identify each user and associate the respective information with them.</p><p>Sessions are usually short-lived, which makes them ideal for storing temporary states between pages.
Sessions also expire once the user closes his browser or after a predefined amount of time (for example, 30 minutes).</p><p>The basic workflow is:</p><ol><li>The server starts a new session (sets a cookie via the HTTP Cookie header).</li><li>The server sets a new session variable (stored on the server-side).</li><li>When the client changes the page, it sends all the cookies in the request, along with the session ID from step 1.</li><li>The server reads the session ID from the cookie.</li><li>The server matches the session ID with the entries of a local list (in-memory, text file etc.).</li><li>If the server finds a match, it reads the stored variables. For PHP, these variables will become available in the superglobal variable <code>$_SESSION</code>.</li><li>If the server doesn’t find a match, it will create a new session and repeat steps 1-6.</li></ol><p><img src=./assets/session.jpg alt="Session lifecycle"></p><p>Example of a session in PHP:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#ce5c00;font-weight:700>&lt;?</span><span style=color:#000>php</span>
<span style=color:#000>session_start</span><span style=color:#000;font-weight:700>();</span> <span style=color:#8f5902;font-style:italic>// Start the session
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>$_SESSION</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;username&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;John Doe&#34;</span><span style=color:#000;font-weight:700>;</span> 
<span style=color:#000>$_SESSION</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;is_admin&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>echo</span> <span style=color:#4e9a06>&#34;Hello &#34;</span> <span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#000>$_SESSION</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;username&#39;</span><span style=color:#000;font-weight:700>];</span>
<span style=color:#8f5902;font-style:italic>?&gt;</span><span style=color:#a40000>
</span></code></pre></div><p>Example of a session in Python:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>s</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>requests</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Session</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000>s</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;https://httpbin.org/cookies/set/sessioncookie/123456789&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>r</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>s</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;https://httpbin.org/cookies&#39;</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>r</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>text</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#8f5902;font-style:italic># &#39;{&#34;cookies&#34;: {&#34;sessioncookie&#34;: &#34;123456789&#34;}}&#39;</span>
</code></pre></div><p>One might consider that sessions are pretty secure.
However, they won’t stop an attacker to intercept the cookie with the session ID, for example using a <a href=https://www.imperva.com/learn/application-security/man-in-the-middle-attack-mitm/>Man-in-the-Middle attack</a> over an insecure Wi-Fi connection, and steal the session ID to use it.
This won’t give them access to the values that are stored on the server, but they will be able to impersonate the user or perform actions on their behalf.
This is known as session hijacking.
You can read more on this subject <a href=https://owasp.org/www-community/attacks/Session_hijacking_attack>here</a> and <a href=https://www.netsparker.com/blog/web-security/session-hijacking/>here</a>.</p><h1 id=authentication-vs-authorization>Authentication vs Authorization</h1><p>Two concepts that usually make people confused are authentication and authorization.
Both terms are often used in conjunction with each other when it comes to security and gaining access to the system.
They are essential in almost every modern web application, as most of these apps need a way to uniquely identify their users using an account.
These accounts can contain both personal information, available only to the logged in user, and public information, available to anybody.
Based on the privilege level, users can have access to various functionalities, such as deleting other users, creating blog posts etc.</p><p>Fundamentally, authentication refers to <strong>who you are</strong> while authorization refers to <strong>what you can do</strong>.</p><p><strong>Authentication</strong> is the process of verifying the identity of a person or device.
A common example is entering a username and password when you log in to a website.
Entering the correct login information lets the website know who you are and that it is actually you accessing the website.</p><p>There could be other methods of authentication, such as passcodes, biometrics (fingerprints), Two-Factor Authentication, etc.
We won’t insist too much on these other methods, but it’s good to know they exist.</p><p><strong>Authorization</strong> is a security mechanism to determine access levels or user/client privileges related to system resources including files, services, computer programs, data and application features.
This is the process of granting or denying access to a network resource that allows the user access to various resources based on the user&rsquo;s identity.</p><h2 id=real-life-scenarios>Real-life scenarios</h2><p>Now imagine what would happen if someone obtains access to your Facebook account.
Besides the previously public information, such as your name and your birthday, they can now view your friend lists, private conversations, or even impersonate you through a post.
Although this situation won’t affect Facebook directly, it will certainly affect you.</p><p>What if someone were to gain access to an administrator account of a university?
They could remove all the students, erase their grades and all the study materials.
This would be a really nefarious incident that would destroy the institution’s reputation and will also affect you as a student.</p><p>This is why authentication and authorization are very important and their security is crucial.</p><h1 id=path-traversal>Path Traversal</h1><p>In many web applications, resources are accessed using a filename as a parameter.
This file is processed and displayed to the client by the application.
If the application does not verify the parameter, the attacker might be able to exploit the application and display an arbitrary file from the target system.
Normally an attacker would try to access password or configuration files to gain access to the system.
Obviously, server-side script files could be accessed to perform manual inspection for vulnerabilities.
Consider the following URL:</p><p><code>http://example.com/view.php?file=image.jpg</code></p><p>If the attacker wants to investigate the view.php file for possible exploitable coding mistakes, he would try to use the script in order to open the file:</p><p><code>http://example.com/view.php?file=view.php</code></p><p>It is likely that images are stored in a subdirectory, so the attacker might have to access the parent directory:</p><p><code>http://example.com/view.php?file=../view.php</code> or <code>http://example.com/view.php?file=../../view.php</code></p><p>Depending on the system, a backslash could also be used:</p><p><code>http://example.com/view.php?file=..\..\view.php</code></p><p>An example of accessing system files:</p><p><code>http://example.com/view.php?file=../../../../etc/passwd</code></p><p><img src=./assets/path_traversal.png alt="Path Traversal"></p><h2 id=path-traversal-prevention>Path Traversal Prevention</h2><p>The application should not allow directory traversal or the accessing of arbitrary files.
If the files to be accessed are known, the application should implement a mapping between the file and application-specific identifier.
This identifier can be hardcoded in the application to prevent any malicious attempts to modify it.</p><p>If it is considered unavoidable to pass user-supplied input to filesystem APIs, then two layers of defense should be used together to prevent attacks:</p><ul><li>The application should validate the user input before processing it.
Ideally, the validation should compare against a whitelist of permitted values.
If that isn&rsquo;t possible for the required functionality, then the validation should verify that the input contains only permitted content, such as purely alphanumeric characters.</li><li>After validating the supplied input, the application should append the input to the base directory and use a platform filesystem API to canonicalize the path.
It should verify that the canonicalized path starts with the expected base directory.</li></ul><p>Below is an example of some simple Java code to validate the canonical path of a file based on user input:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000>File</span> <span style=color:#000>file</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>File</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BASE_DIRECTORY</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>userInput</span><span style=color:#ce5c00;font-weight:700>);</span><span style=color:#a40000>`</span> 
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>file</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCanonicalPath</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>startsWith</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BASE_DIRECTORY</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#a40000>`</span> 
<span style=color:#8f5902;font-style:italic>// process file
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><h1 id=insecure-direct-object-references>Insecure Direct Object References</h1><p>Insecure direct object reference vulnerability is similar to path traversal vulnerability.
The application allows access to resources using an identifier that is controllable by the user.
In this case, however, the identifier is not a file / path as is the case with path traversal.</p><p>Consider the following case where a user is able to view his own invoice:</p><p><code>http://www.example.com/view.php?invoice=24411</code></p><p>Now, by changing the invoice number the user might be able to access other invoices, including ones that are not his own, thereby gaining access to the sensitive information of other users.
Obviously the application should enforce access control over the items to be accessed.
If the application fails to do so, this would be a case of insecure direct object reference vulnerability.</p><p>When performing penetration tests, the application parameters should certainly be investigated by iterating through possible values and observing the responses.</p><p><img src=./assets/insecure_direct_object_references.png alt="Insecure Direct Object References"></p><h2 id=insecure-direct-object-references-prevention>Insecure Direct Object References Prevention</h2><p>First, you should control all normal, ajax and API requests when creating an application.
For example, can a read-only user write anything in the app?
Or can a non-admin user access and create API tokens that should only be created by an admin user?
So, in order to test all the possible IDOR vulnerabilities, you should think like a hacker.</p><p>You can provide permissions on your application for all endpoints.
If your <code>privatesection</code> endpoint includes the API requests such as <code>/api/privatesection/admins</code>, <code>/api/privatesection/console</code>, <code>/api/privatesection/tokens</code>, you can block the endpoint for non-admin users.</p><p>Moreover, to make the attacker’s job harder or prevent it altogether, you can use hash functions and hashed values instead of regular numbers and strings.</p><h2 id=robotstxt-preventing-caching>robots.txt: Preventing Caching</h2><p>The <strong>robots.txt</strong> file provides a list of instructions for automated Web crawlers, also called robots or bots.
Standardized at <a href=http://www.robotstxt.org/robotstxt.html>robotstxt</a>, this file allows you to define, with a great deal of precision, which files and directories are off-limits to Web robots.
The robots.txt file must be placed in the root of the Web server with permissions that allow the Web server to read the file.
Lines in the file beginning with a # sign are considered comments and are ignored.
Each line not beginning with a <code>#</code> should begin with either a User-agent or a disallow statement, followed by a colon and an optional space.
These lines are written to disallow certain crawlers from accessing certain directories or files.</p><p>Each Web crawler should send a user-agent field, which lists the name or type of the crawler.
The value of Google’s user-agent field is <code>Googlebot</code>.
To address a disallow to Google, the user-agent line should read:</p><p><code>User-agent: Googlebot</code></p><p>According to the original specification, the wildcard character <code>*</code> can be used in the user-agent field to indicate all crawlers.
The disallow line describes what, exactly; the crawler should not look at.</p><p><strong>NOTE:</strong> Hackers don’t have to obey your robots.txt file.
In fact, Web crawlers really don’t have to either, although most of the big-name Web crawlers will, if only for the “CYA” factor.
One fairly common hacker trick is to view a site’s robots.txt file first to get an idea of how files and directories are mapped on the server.
In fact a quick Google query can reveal lots of sites that have had their robots.txt files crawled.
This, of course, is a misconfiguration, because the robots.txt file is meant to stay behind the scenes.</p><h2 id=sitemapxml>Sitemap.xml</h2><p>The sitemap.xml is a simple XML page which could be available on some websites and provide a “roadmap” for Google to the important pages that need to be crawled.
It’s a SEO (Search Engine Optimization) tool to help with the visibility of your website on the internet, but it could also be useful for a hacker, serving basically the same purpose: to give him a roadmap to every page.</p><h2 id=examples-of-google-dorking>Examples of Google Dorking</h2><ul><li><p>Google Hacking tool from <a href=https://pentest-tools.com/information-gathering/google-hacking>Pentest-Tools</a></p></li><li><p>Passive Google Dork <a href=https://github.com/opsdisk/pagodo>Pagodo</a></p></li></ul><h3 id=explore-log-files-for-login-credentials>Explore LOG Files For Login Credentials</h3><p><code>allintext:password filetype:log after:2019</code> - Finds exposed log files that might contain passwords.</p><p><code>allintext:username filetype:log</code> - Finds logs that contain usernames.</p><p><strong>Prevention:</strong> Do not allow Google to access important data of your website, by properly configuring robots.txt.</p><h3 id=explore-configurations-using-env-files>Explore Configurations Using <strong>ENV</strong> files</h3><p>.env is used by various popular web development frameworks to declare general variables and configurations.</p><p><code>DB_USERNAME filetype:env</code><br><code>DB_PASSWORD filetype:enc=v</code></p><p>By using the command you can find a list of sites that expose their <em>.env</em> file on the internet.
Developers may accidentally include the <em>.env</em> file in the public directory of the website, which can cause great harm if cyber criminals find it.</p><p>If you click into any of the exposed .env files, you will notice unencrypted usernames, passwords and IPs are directly exposed in the search results.
<strong>Prevention:</strong> <em>.env</em> files should <strong>not</strong> be in a publicly accessible folder.</p><h2 id=wayback-machine>Wayback Machine</h2><p>The <a href=https://archive.org/web/>Wayback Machine</a> is a digital archive of the entire internet.
It allows the user to go “back in time” and see what websites looked like in the past.
For a hacker, it can be useful to see what information was displayed on a website a few months ago or even a few years ago.</p><h1 id=wrap-up>Wrap-up</h1><p>In this rapidly evolving world, the technologies we use change at a very fast pace.
We need to constantly implement new systems to help solve the issues that arise.
Since HTTP is stateless, dynamic web applications needed a way to preserve the state between requests, so they used cookies and sessions.</p><p>It’s very important to understand the difference between authentication and authorization.
Almost every web application on the internet today has one form or another of authentication and authorization.
Many <a href="https://techterms.com/definition/framework#:~:text=A%20framework%2C%20or%20software%20framework,programs%20for%20a%20specific%20platform">frameworks</a> and <a href=https://techterms.com/definition/cms>Content Management Systems</a> provide built-in implementations of authorization and authentication to make the job of web developers easier.</p><h1 id=browser-extensions>Browser Extensions</h1><p>Some browser extensions can make your life easier when interacting with the websites. Some examples would be:</p><ul><li><p><strong>EditThisCookie</strong>: Lets you quickly add, edit or delete a cookie.
It could be useful to open a context-menu with one click and edit a cookie on the fly while navigating, without the need to open the developer tools console.</p><ul><li>Google Chrome link: <a href=https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg>https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg</a></li><li>Mozilla Firefox link: <a href=https://addons.mozilla.org/en-US/firefox/addon/etc2/>https://addons.mozilla.org/en-US/firefox/addon/etc2/</a></li></ul></li><li><p><strong>ModHeader</strong>: Lets you add, modify and remove request headers and response headers. You can use this extension to set <strong>X-Forwarded-For</strong>, <strong>Authorization</strong>, <strong>Access-Control-Allow-Origin</strong> and other headers and remember your settings across your account.</p><ul><li>Google Chrome link: <a href=https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj>https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj</a></li><li>Mozilla Firefox link: <a href=https://addons.mozilla.org/en-US/firefox/addon/modheader-firefox/>https://addons.mozilla.org/en-US/firefox/addon/modheader-firefox/</a></li></ul></li><li><p><strong>Hasher</strong>: An extension to quickly generate most common <strong>hashes</strong> (<em>MD5</em>, <em>SHA-1</em>, <em>SHA-224</em>, <em>SHA-256</em>, <em>SHA-384</em>, <em>SHA-512</em>, etc), <strong>ciphers</strong> (<em>AES-256</em>, <em>DES</em>, <em>Triple-DES</em>, <em>RC4</em>, etc), <strong>ROT13</strong>, <strong>HMAC</strong>, <strong>CRC</strong> (<em>CRC-8</em>, <em>CRC 16</em>), for a given input. You can also convert timestamps to human readable formats, convert numbers from different bases (hex, binary, dec), encode or decode strings and convert between <em>ASCII</em>, <em>HEX</em>, <em>UTF-8</em>, etc.</p><ul><li>Google Chrome link: <a href=https://chrome.google.com/webstore/detail/hasher/kignjplbjlocolcfldfhbonmbblpfbjb>https://chrome.google.com/webstore/detail/hasher/kignjplbjlocolcfldfhbonmbblpfbjb</a></li></ul></li></ul><h1 id=further-reading>Further Reading</h1><ul><li>[1] Metropolia University of Applied Sciences - Applied Web Application Security Course</li><li>[2] <a href=https://en.wikipedia.org/wiki/HTTP_cookie>https://en.wikipedia.org/wiki/HTTP_cookie</a></li><li>[3] <a href=https://stackoverflow.com/questions/11142882/what-are-cookies-and-sessions-and-how-do-they-relate-to-each-other>https://stackoverflow.com/questions/11142882/what-are-cookies-and-sessions-and-how-do-they-relate-to-each-other</a></li><li>[4] <a href=https://docs.python-requests.org/en/master/user/advanced/>https://docs.python-requests.org/en/master/user/advanced/</a></li><li>[5] <a href=https://stackoverflow.com/questions/11142882/what-are-cookies-and-sessions-and-how-do-they-relate-to-each-other>https://stackoverflow.com/questions/11142882/what-are-cookies-and-sessions-and-how-do-they-relate-to-each-other</a></li><li>[6] <a href=https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg>https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg</a></li><li>[7] <a href=https://danielmiessler.com/study/encoding-encryption-hashing-obfuscation/>https://danielmiessler.com/study/encoding-encryption-hashing-obfuscation/</a></li><li>[8] <a href=https://searchsecurity.techtarget.com/tip/How-to-encrypt-and-secure-a-website-using-HTTPS>https://searchsecurity.techtarget.com/tip/How-to-encrypt-and-secure-a-website-using-HTTPS</a></li><li>[9] <a href=https://www.linkedin.com/learning/asp-dot-net-core-identity-authentication-management>https://www.linkedin.com/learning/asp-dot-net-core-identity-authentication-management</a></li><li>[10] <a href=https://techterms.com/definition/authentication>https://techterms.com/definition/authentication</a></li><li>[11] <a href=https://www.bugcrowd.com/blog/how-to-find-idor-insecure-direct-object-reference-vulnerabilities-for-large-bounty-rewards/>https://www.bugcrowd.com/blog/how-to-find-idor-insecure-direct-object-reference-vulnerabilities-for-large-bounty-rewards/</a></li><li>[12] <a href=https://portswigger.net/web-security/file-path-traversal>https://portswigger.net/web-security/file-path-traversal</a></li><li>[13] <a href=https://www.amazon.com/Google-Hacking-Penetration-Testers-1/dp/1931836361>https://www.amazon.com/Google-Hacking-Penetration-Testers-1/dp/1931836361</a></li><li>[14] <a href=https://securitytrails.com/blog/google-hacking-techniques>https://securitytrails.com/blog/google-hacking-techniques</a></li><li>[15] <a href=https://www.acunetix.com/websitesecurity/google-hacking/>https://www.acunetix.com/websitesecurity/google-hacking/</a></li><li>[16] <a href=https://www.sciencedirect.com/science/article/pii/B9781931836364500087>https://www.sciencedirect.com/science/article/pii/B9781931836364500087</a></li></ul><h1 id=activities>Activities</h1><p><strong>1.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Nobody loves me</a><br><strong>2.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Do you need glasses?</a><br><strong>3.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Chef hacky mchack</a><br><strong>4.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Santa</a><br><strong>5.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Great Names</a><br><strong>6.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Mind your own business</a><br><strong>7.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Beep Beep Boop</a><br><strong>8.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Let&rsquo;s traverse the universe</a><br><strong>9.</strong> <a href="https://sss-ctf.security.cs.pub.ro/challenges?category=web-sessions">Color</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-6d3ea5280422db131d38d303e9ab2bdd>3 -</h1><h1 id=sql-injection>SQL Injection</h1><p>In this session, we&rsquo;ll explain what SQL injection is, describe some common examples, explain how to find and exploit various kinds of SQL injection vulnerabilities, and summarize how to prevent SQL injection.</p><p><strong>NOTE:</strong></p><p>For this session you&rsquo;ll need to use <a href=https://portswigger.net/burp>Burp Suite</a> so please follow the links in the <a href=#further-reading>Further Reading</a> section to set it up if you haven&rsquo;t done so yet.[<a href=https://portswigger.net/support/configuring-your-browser-to-work-with-burp>2</a>,<a href=https://portswigger.net/support/checking-your-browser-proxy-configuration>3</a>,<a href=https://portswigger.net/support/installing-burp-suites-ca-certificate-in-your-browser>4</a>]</p><h2 id=what-is-sql-injection>What is SQL injection</h2><p>SQL injection is a web security vulnerability that allows an attacker to interfere with the queries that an application makes to its database.
It generally allows attackers to view data that they are not normally able to retrieve.
This might include data belonging to other users, or any other data that the application itself is able to access.
In many cases, an attacker can modify or delete this data, causing persistent changes to the application&rsquo;s content or behavior.</p><p>In some situations, an attacker can escalate an SQL injection attack to compromise the underlying server or other back-end infrastructure or perform a denial-of-service attack.</p><h3 id=what-is-the-impact-of-a-successful-sql-injection-attack>What is the impact of a successful SQL injection attack?</h3><p>A successful SQL injection attack can result in unauthorized access to sensitive data, such as passwords, credit card details, or personal user information.
Many high-profile data breaches in recent years have been the result of SQL injection attacks, leading to reputational damage and regulatory fines.
In some cases, an attacker can obtain a persistent backdoor into an organization&rsquo;s systems, leading to a long-term compromise that can go unnoticed for an extended period.</p><h3 id=sql-injection-examples>SQL injection examples</h3><p>There are a wide variety of SQL injection vulnerabilities, attacks, and techniques, which arise in different situations.
Some common SQL injection examples include:</p><ul><li><strong><a href=##retrieving-hidden-data>Retrieving hidden data</a></strong> - you can modify an SQL query to return additional results.</li><li><strong><a href=##subverting-application-logic>Subverting application logic</a></strong> - you can change a query to interfere with the application&rsquo;s logic.</li><li><strong><a href=##SQL-injection-UNION-attacks>UNION attacks</a></strong> - you can retrieve data from different database tables.</li><li><strong><a href=##Examining-the-database>Examining the database</a></strong> - you can extract information about the version and structure of the database.</li><li><strong><a href=##Blind-SQL-injection>Blind SQL injection</a></strong> - the results of a query you control are not returned in the application&rsquo;s responses.</li></ul><hr><h2 id=retrieving-hidden-data>Retrieving hidden data</h2><p>Consider a shopping application that displays products in different categories.
When the user clicks on the Gifts category, their browser requests the URL:</p><p><code>https://insecure-website.com/products?category=Gifts</code></p><p>This causes the application to make an SQL query to retrieve details of the relevant products from the database:</p><p><code>SELECT * FROM products WHERE category = 'Gifts' AND released = 1</code></p><p>This SQL query asks the database to return:</p><ul><li>all details (*)</li><li>from the products table</li><li>where the category is Gifts</li><li>and released is 1.</li></ul><p>The restriction <code>released = 1</code> is being used to hide products that are not released.
For unreleased products, presumably <code>released = 0</code>.</p><p>The application doesn&rsquo;t implement any defenses against SQL injection attacks, so an attacker can construct an attack like:</p><p><code>https://insecure-website.com/products?category=Gifts'--</code></p><p>This results in the SQL query:</p><p><code>SELECT * FROM products WHERE category = 'Gifts'--' AND released = 1</code></p><p>The key thing here is that the double-dash sequence <code>--</code> is a comment indicator in SQL, and means that the rest of the query is interpreted as a comment.
This effectively removes the remainder of the query, so it no longer includes <code>AND released = 1</code>.
This means that all products are displayed, including unreleased products.</p><p>Going further, an attacker can cause the application to display all the products in any category, including categories that they don&rsquo;t know about:</p><p><code>https://insecure-website.com/products?category=Gifts'+OR+1=1--</code></p><p>This results in the SQL query:</p><p><code>SELECT * FROM products WHERE category = 'Gifts' OR 1=1--' AND released = 1</code></p><p>The modified query will return all items where either the category is Gifts, or 1 is equal to 1.
Since 1=1 is always true, the query will return all items.</p><h2 id=subverting-application-logic>Subverting application logic</h2><p>Consider an application that lets users log in with a username and password.
If a user submits the username <code>wiener</code> and the password <code>bluecheese</code>, the application checks the credentials by performing the following SQL query:</p><p><code>SELECT * FROM users WHERE username = 'wiener' AND password = 'bluecheese'</code></p><p>If the query returns the details of a user, then the login is successful.
Otherwise, it is rejected.</p><p>Here, an attacker can log in as any user without a password simply by using the SQL comment sequence <code>--</code> to remove the password check from the <code>WHERE</code> clause of the query.
For example, submitting the username <code>administrator'--</code> and a blank password results in the following query:</p><p><code>SELECT * FROM users WHERE username = 'administrator'--' AND password = ''</code></p><p>This query returns the user whose username is <code>administrator</code> and successfully logs the attacker in as that user.</p><h2 id=retrieving-data-from-other-database-tables>Retrieving data from other database tables</h2><p>In cases where the results of an SQL query are returned within the application&rsquo;s responses, an attacker can leverage an SQL injection vulnerability to retrieve data from other tables within the database.
This is done using the <code>UNION</code> keyword, which lets you execute an additional <code>SELECT</code> query and append the results to the original query.</p><p>For example, if an application executes the following query containing the user input &ldquo;Gifts&rdquo;:</p><p><code>SELECT name, description FROM products WHERE category = 'Gifts'</code></p><p>then an attacker can submit the input:</p><p><code>' UNION SELECT username, password FROM users--</code></p><p>This will cause the application to return all usernames and passwords along with the names and descriptions of products.</p><h2 id=sql-injection-union-attacks>SQL injection UNION attacks</h2><p>When an application is vulnerable to SQL injection and the results of the query are returned within the application&rsquo;s responses, the <code>UNION</code> keyword can be used to retrieve data from other tables within the database.
This results in an SQL injection UNION attack.</p><p>The <code>UNION</code> keyword lets you execute one or more additional <code>SELECT</code> queries and append the results to the original query.
For example:</p><p><code>SELECT a, b FROM table1 UNION SELECT c, d FROM table2</code></p><p>This SQL query will return a single result set with two columns, containing values from columns <code>a</code> and <code>b</code> in <code>table1</code> and columns <code>c</code> and <code>d</code> in <code>table2</code>.</p><p>For a <code>UNION</code> query to work, two key requirements must be met:</p><ul><li>The individual queries must return the same number of columns.</li><li>The data types in each column must be compatible between the individual queries.</li></ul><p>To carry out an SQL injection UNION attack, you need to ensure that your attack meets these two requirements.
This generally involves figuring out:</p><ul><li>How many columns are being returned from the original query?</li><li>Which columns returned from the original query are of a suitable data type to hold the results from the injected query?</li></ul><h3 id=determining-the-number-of-columns-required-in-an-sql-injection-union-attack>Determining the number of columns required in an SQL injection UNION attack</h3><p>When performing an SQL injection UNION attack, there are two effective methods to determine how many columns are being returned from the original query.</p><p>The first method involves injecting a series of <code>ORDER BY</code> clauses and incrementing the specified column index until an error occurs.
For example, assuming the injection point is a quoted string within the <code>WHERE</code> clause of the original query, you would submit:</p><ul><li><code>' ORDER BY 1--</code></li><li><code>' ORDER BY 2--</code></li><li><code>' ORDER BY 3--</code></li></ul><p>etc.</p><p>This series of payloads modifies the original query to order the results by different columns in the result set.
The column in an <code>ORDER BY</code> clause can be specified by its index, so you don&rsquo;t need to know the names of any columns.
When the specified column index exceeds the number of actual columns in the result set, the database returns an error, such as:</p><p><code>The ORDER BY position number 3 is out of range of the number of items in the select list.</code></p><p>The application might actually return the database error in its HTTP response, or it might return a generic error, or simply return no results.
Provided you can detect some difference in the application&rsquo;s response, you can infer how many columns are being returned from the query.</p><p>The second method involves submitting a series of <code>UNION SELECT</code> payloads specifying a different number of null values:</p><ul><li><code>' UNION SELECT NULL--</code></li><li><code>' UNION SELECT NULL,NULL--</code></li><li><code>' UNION SELECT NULL,NULL,NULL--</code></li></ul><p>etc.</p><p>If the number of nulls does not match the number of columns, the database returns an error, such as:</p><p><code>All queries combined using a UNION, INTERSECT or EXCEPT operator must have an equal number of expressions in their target lists.</code></p><p>Again, the application might actually return this error message, or might just return a generic error or no results.
When the number of nulls matches the number of columns, the database returns an additional row in the result set, containing null values in each column.
The effect on the resulting HTTP response depends on the application&rsquo;s code.
If you are lucky, you will see some additional content within the response, such as an extra row on an HTML table.
Otherwise, the null values might trigger a different error, such as a <code>NullPointerException</code>.
Worst case, the response might be indistinguishable from that which is caused by an incorrect number of nulls, making this method of determining the column count ineffective.</p><p><strong>NOTE:</strong></p><ul><li>The reason for using <code>NULL</code> as the values returned from the injected <code>SELECT</code> query is that the data types in each column must be compatible between the original and the injected queries.
Since <code>NULL</code> is convertible to every commonly used data type, using <code>NULL</code> maximizes the chance that the payload will succeed when the column count is correct.</li><li>In Oracle, every <code>SELECT</code> query must use the FROM keyword and specify a valid table.
There is a built-in table in Oracle called <code>DUAL</code> which can be used for this purpose.
So the injected queries in Oracle would need to look like: <code>' UNION SELECT NULL FROM DUAL--</code>.</li><li>The payloads described use the double-dash comment sequence <code>--</code> to comment out the remainder of the original query following the injection point.
In MySQL, the double-dash sequence must be followed by a space. Alternatively, the hash character <code>#</code> can be used to identify a comment.</li></ul><p>For more details of database-specific syntax, see the <a href=https://portswigger.net/web-security/sql-injection/cheat-sheet>SQL injection cheat sheet</a>.</p><h3 id=finding-columns-with-a-useful-data-type-in-an-sql-injection-union-attack>Finding columns with a useful data type in an SQL injection UNION attack</h3><p>The reason for performing an SQL injection UNION attack is to be able to retrieve the results from an injected query.
Generally, the interesting data that you want to retrieve will be in string form, so you need to find one or more columns in the original query results whose data type is, or is compatible with, string data.</p><p>Having already determined the number of required columns, you can probe each column to test whether it can hold string data by submitting a series of <code>UNION SELECT</code> payloads that place a string value into each column in turn.
For example, if the query returns four columns, you would submit:</p><ul><li><code>' UNION SELECT 'a',NULL,NULL,NULL--</code></li><li><code>' UNION SELECT NULL,'a',NULL,NULL--</code></li><li><code>' UNION SELECT NULL,NULL,'a',NULL--</code></li><li><code>' UNION SELECT NULL,NULL,NULL,'a'--</code></li></ul><p>If the data type of a column is not compatible with string data, the injected query will cause a database error, such as:</p><p><code>Conversion failed when converting the varchar value 'a' to data type int.</code></p><p>If an error does not occur, and the application&rsquo;s response contains some additional content including the injected string value, then the relevant column is suitable for retrieving string data.</p><h3 id=using-an-sql-injection-union-attack-to-retrieve-interesting-data>Using an SQL injection UNION attack to retrieve interesting data</h3><p>When you have determined the number of columns returned by the original query and found which columns can hold string data, you are in a position to retrieve interesting data.</p><p>Suppose that:</p><ul><li>The original query returns two columns, both of which can hold string data.</li><li>The injection point is a quoted string within the <code>WHERE</code> clause.</li><li>The database contains a table called <code>users</code> with the columns <code>username</code> and <code>password</code>.</li></ul><p>In this situation, you can retrieve the contents of the <code>users</code> table by submitting the input:</p><p><code>' UNION SELECT username, password FROM users--</code></p><p>Of course, the crucial information needed to perform this attack is that there is a table called <code>users</code> with two columns called <code>username</code> and <code>password</code>.
Without this information, you would be left trying to guess the names of tables and columns.
In fact, all modern databases provide ways of examining the database structure, to determine what tables and columns it contains.</p><h3 id=retrieving-multiple-values-within-a-single-column>Retrieving multiple values within a single column</h3><p>In the preceding example, suppose instead that the query only returns a single column.</p><p>You can easily retrieve multiple values together within this single column by concatenating the values together, ideally including a suitable separator to let you distinguish the combined values.
For example, in Oracle you could submit the input:</p><p><code>' UNION SELECT username || '~' || password FROM users--</code></p><p>This uses the double-pipe sequence <code>||</code> which is a string concatenation operator in Oracle.
The injected query concatenates together the values of the <code>username</code> and <code>password</code> fields, separated by the <code>~</code> character.</p><p>The results from the query will let you read all of the usernames and passwords, for example:</p><pre><code>...
administrator~s3cure
wiener~peter
carlos~montoya
...
</code></pre><p>Note that different databases use different syntax to perform string concatenation.
For more details, see the <a href=https://portswigger.net/web-security/sql-injection/cheat-sheet>SQL injection cheat sheet</a>.</p><h2 id=examining-the-database>Examining the database</h2><p>Following the initial identification of an SQL injection vulnerability, it is generally useful to obtain some information about the database itself.
This information can often pave the way for further exploitation.</p><p>You can query the version details for the database.
The way that this is done depends on the database type, so you can infer the database type from whichever technique works.
For example, in Oracle you can execute:</p><p><code>SELECT * FROM v$version</code></p><p>You can also determine what database tables exist, and which columns they contain.
For example, on most databases you can execute the following query to list the tables:</p><p><code>SELECT * FROM information_schema.tables</code></p><h3 id=querying-the-database-type-and-version>Querying the database type and version</h3><p>Different databases provide different ways of querying their version.
You often need to try out different queries to find one that works, allowing you to determine both the type and version of the database software.</p><p>The queries to determine the database version for some popular database types are as follows:</p><table><thead><tr><th>Database type</th><th>Query</th></tr></thead><tbody><tr><td>Microsoft, MySQL</td><td><code>SELECT @@version</code></td></tr><tr><td>Oracle</td><td><code>SELECT * FROM v$version</code></td></tr><tr><td>PostgreSQL</td><td><code>SELECT version()</code></td></tr></tbody></table><p>For example, you could use a <code>UNION</code> attack with the following input:</p><p><code>' UNION SELECT @@version--</code></p><p>This might return output like the following, confirming that the database is Microsoft SQL Server, and the version that is being used:</p><pre><code>Microsoft SQL Server 2016 (SP2) (KB4052908) - 13.0.5026.0 (X64)
Mar 18 2018 09:11:49
Copyright (c) Microsoft Corporation
Standard Edition (64-bit) on Windows Server 2016 Standard 10.0 &lt;X64&gt; (Build 14393: ) (Hypervisor)
</code></pre><h2 id=blind-sql-injection>Blind SQL injection</h2><p>In this section, we&rsquo;ll describe what blind SQL injection is, explain various techniques for finding and exploiting blind SQL injection vulnerabilities.</p><h3 id=what-is-blind-sql-injection>What is blind SQL injection?</h3><p>Blind SQL injection arises when an application is vulnerable to SQL injection, but its HTTP responses do not contain the results of the relevant SQL query or the details of any database errors.</p><p>With blind SQL injection vulnerabilities, many techniques such as UNION attacks are not effective, because they rely on being able to see the results of the injected query within the application&rsquo;s responses.
It is still possible to exploit blind SQL injection to access unauthorized data, but different techniques must be used.</p><h3 id=exploiting-blind-sql-injection-by-triggering-conditional-responses>Exploiting blind SQL injection by triggering conditional responses</h3><p>Consider an application that uses tracking cookies to gather analytics about usage.
Requests to the application include a cookie header like this:</p><p><code>Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4</code></p><p>When a request containing a <code>TrackingId</code> cookie is processed, the application determines whether this is a known user using an SQL query like this:</p><p><code>SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'u5YD3PapBcR4lN3e7Tj4'</code></p><p>This query is vulnerable to SQL injection, but the results from the query are not returned to the user.
However, the application does behave differently depending on whether the query returns any data.
If it returns data (because a recognized <code>TrackingId</code> was submitted), then a &ldquo;Welcome back&rdquo; message is displayed within the page.</p><p>This behavior is enough to be able to exploit the blind SQL injection vulnerability and retrieve information by triggering different responses conditionally, depending on an injected condition.
To see how this works, suppose that two requests are sent containing the following <code>TrackingId</code> cookie values in turn:</p><p><code>xyz' AND '1'='1</code><br><code>xyz' AND '1'='2</code></p><p>The first of these values will cause the query to return results, because the injected <code>AND '1'='1</code> condition is true, and so the &ldquo;Welcome back&rdquo; message will be displayed.
Whereas the second value will cause the query to not return any results, because the injected condition is false, and so the &ldquo;Welcome back&rdquo; message will not be displayed.
This allows us to determine the answer to any single injected condition, and so extract data one bit at a time.</p><p>For example, suppose there is a table called <code>Users</code> with the columns <code>Username</code> and <code>Password</code>, and a user called <code>Administrator</code>.
We can systematically determine the password for this user by sending a series of inputs to test the password one character at a time.</p><p>To do this, we start with the following input:</p><p><code>xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) > 'm</code></p><p>This returns the &ldquo;Welcome back&rdquo; message, indicating that the injected condition is true, and so the first character of the password is greater than <code>m</code>.</p><p>Next, we send the following input:</p><p><code>xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) > 't</code></p><p>This does not return the &ldquo;Welcome back&rdquo; message, indicating that the injected condition is false, and so the first character of the password is not greater than <code>t</code>.</p><p>Eventually, we send the following input, which returns the &ldquo;Welcome back&rdquo; message, thereby confirming that the first character of the password is <code>s</code>:</p><p><code>xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) = 's</code></p><p>We can continue this process to systematically determine the full password for the <code>Administrator</code> user.</p><p><strong>NOTE:</strong></p><p>The <code>SUBSTRING</code> function is called <code>SUBSTR</code> on some types of databases.
For more details, see the <a href=https://portswigger.net/web-security/sql-injection/cheat-sheet>SQL injection cheat sheet</a>.</p><h3 id=inducing-conditional-responses-by-triggering-sql-errors>Inducing conditional responses by triggering SQL errors</h3><p>In the preceding example, suppose instead that the application carries out the same SQL query, but does not behave any differently depending on whether the query returns any data.
The preceding technique will not work, because injecting different Boolean conditions makes no difference to the application&rsquo;s responses.</p><p>In this situation, it is often possible to induce the application to return conditional responses by triggering SQL errors conditionally, depending on an injected condition.
This involves modifying the query so that it will cause a database error if the condition is true, but not if the condition is false.
Very often, an unhandled error thrown by the database will cause some difference in the application&rsquo;s response (such as an error message), allowing us to infer the truth of the injected condition.</p><p>To see how this works, suppose that two requests are sent containing the following <code>TrackingId</code> cookie values in turn:</p><p><code>xyz' AND (SELECT CASE WHEN (1=2) THEN 1/0 ELSE 'a' END)='a</code>
<code>xyz' AND (SELECT CASE WHEN (1=1) THEN 1/0 ELSE 'a' END)='a</code></p><p>These inputs use the <code>CASE</code> keyword to test a condition and return a different expression depending on whether the expression is true.
With the first input, the <code>CASE</code> expression evaluates to <code>'a'</code>, which does not cause any error.
With the second input, it evaluates to <code>1/0</code>, which causes a divide-by-zero error.
Assuming the error causes some difference in the application&rsquo;s HTTP response, we can use this difference to infer whether the injected condition is true.</p><p>Using this technique, we can retrieve data in the way already described, by systematically testing one character at a time:</p><p><code>xyz' AND (SELECT CASE WHEN (Username = 'Administrator' AND SUBSTRING(Password, 1, 1) > 'm') THEN 1/0 ELSE 'a' END FROM Users)='a</code></p><h3 id=exploiting-blind-sql-injection-by-triggering-time-delays>Exploiting blind SQL injection by triggering time delays</h3><p>In the preceding example, suppose that the application now catches database errors and handles them gracefully.
Triggering a database error when the injected SQL query is executed no longer causes any difference in the application&rsquo;s response, so the preceding technique of inducing conditional errors will not work.</p><p>In this situation, it is often possible to exploit the blind SQL injection vulnerability by triggering time delays conditionally, depending on an injected condition.
Because SQL queries are generally processed synchronously by the application, delaying the execution of an SQL query will also delay the HTTP response.
This allows us to infer the truth of the injected condition based on the time taken before the HTTP response is received.</p><p>The techniques for triggering a time delay are highly specific to the type of database being used.
On Microsoft SQL Server, input like the following can be used to test a condition and trigger a delay depending on whether the expression is true:</p><p><code>'; IF (1=2) WAITFOR DELAY '0:0:10'--</code>
<code>'; IF (1=1) WAITFOR DELAY '0:0:10'--</code></p><p>The first of these inputs will not trigger a delay, because the condition <code>1=2</code> is false.
The second input will trigger a delay of 10 seconds, because the condition <code>1=1</code> is true.</p><p>Using this technique, we can retrieve data in the way already described, by systematically testing one character at a time:</p><p><code>'; IF (SELECT COUNT(username) FROM Users WHERE username = 'Administrator' AND SUBSTRING(password, 1, 1) > 'm') = 1 WAITFOR DELAY '0:0:{delay}'--</code></p><h3 id=second-order-sql-injection>Second Order SQL Injection</h3><p>A Second Order Injection is the same as a traditional injection attack but the payload is already stored in the database intentionally placed so that it can be triggered in another area of code.</p><p>Let’s look at an example and see how easy it is to exploit this vulnerability.
This is a form of registration that uses parameterization, meaning that a vicious input will not affect the database.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#000>$sql</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;INSERT INTO user (username, password)  VALUES (:username, :password)&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000>$data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
        <span style=color:#4e9a06>&#39;username&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>$userName</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#4e9a06>&#39;password&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>$password</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#4e9a06>&#39;first_name&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>$firstName</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#4e9a06>&#39;second_name&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>$secondName</span>
        <span style=color:#000;font-weight:700>];</span>
<span style=color:#000>$stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>$conn</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#c4a000>prepare</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>$sql</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>$stmt</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#c4a000>execute</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>$data</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Suppose, however, that someone introduces the following structure as a name:</p><p><code>'; DROP TABLE user; --</code></p><p>This will not be a problem for this form, however, this MySQL code is in the database, and if another part of the code uses this name it can be executed.
Let&rsquo;s say that we select the user by name use the following code:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#000>$sql</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;SELECT * FROM user WHERE username = &#39;</span><span style=color:#4e9a06>{</span><span style=color:#000>$userName</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#39;&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000>$stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>$conn</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#c4a000>query</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>$sql</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>$user</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>$stmt</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#c4a000>fetch</span><span style=color:#000;font-weight:700>();</span>
</code></pre></div><p>Because for this piece of code we do not use the parameterization, the code that will be executed will become:</p><p><code>SELECT * FROM user WHERE username = ''; DROP TABLE user; --';</code></p><h3 id=how-to-prevent-blind-sql-injection-attacks>How to prevent <strong>blind</strong> SQL injection attacks?</h3><p>Although the techniques needed to find and exploit blind SQL injection vulnerabilities are different and more sophisticated than for regular SQL injection, the measures needed to prevent SQL injection are the same regardless of whether the vulnerability is blind or not.</p><h2 id=how-to-prevent-sql-injection>How to prevent SQL injection</h2><p>Most instances of SQL injection can be prevented by using parameterized queries (also known as prepared statements) instead of string concatenation within the query.</p><p>The following code is vulnerable to SQL injection because the user input is concatenated directly into the query:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#000>String</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;SELECT * FROM products WHERE category = &#39;&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>input</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;&#39;&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000>Statement</span> <span style=color:#000>statement</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>connection</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>createStatement</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000>ResultSet</span> <span style=color:#000>resultSet</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>statement</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>executeQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>This code can be easily rewritten in a way that prevents the user input from interfering with the query structure:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#000>PreparedStatement</span> <span style=color:#000>statement</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>connection</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>prepareStatement</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT * FROM products WHERE category = ?&#34;</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>statement</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>setString</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>input</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000>ResultSet</span> <span style=color:#000>resultSet</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>statement</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>executeQuery</span><span style=color:#000;font-weight:700>();</span>
</code></pre></div><p>Parameterized queries can be used for any situation where untrusted input appears as data within the query, including the <code>WHERE</code> clause and values in an <code>INSERT</code> or <code>UPDATE</code> statement.
They can&rsquo;t be used to handle untrusted input in other parts of the query, such as table or column names, or the <code>ORDER BY</code> clause.
Application functionality that places untrusted data into those parts of the query will need to take a different approach, such as white-listing permitted input values, or using different logic to deliver the required behavior.</p><p>For a parameterized query to be effective in preventing SQL injection, the string that is used in the query must always be a hard-coded constant, and must never contain any variable data from any origin.
Do not be tempted to decide case-by-case whether an item of data is trusted, and continue using string concatenation within the query for cases that are considered safe.
It is all too easy to make mistakes about the possible origin of data, or for changes in other code to violate assumptions about what data is tainted.</p><h1 id=tools>Tools</h1><h2 id=burp-suite>Burp Suite</h2><p><a href=https://portswigger.net/burp>Burp Suite</a> is one of the most popular penetration testing and vulnerability finder tools, and is often used for checking web application security.
With this tool you can see all the requests that are executed when interacting with a web application.
You can change the requests to see different behaviors and you can set automatic requests with different parameters.</p><h2 id=sqlmap>SQLmap</h2><p><a href=https://sqlmap.org/>SQLmap</a> is an open source penetration testing tool that automates the process of detecting and exploiting SQL injection flaws and taking over database servers.
It comes with a powerful detection engine, many niche features for the ultimate penetration tester and a broad range of switches lasting from database fingerprinting, over data fetching from the database, to accessing the underlying file system and executing commands on the operating system via out-of-band connections.
You can see some of the features in this recording.
<a href=https://asciinema.org/a/434673><img src=https://asciinema.org/a/434673.svg alt=asciicast></a></p><h1 id=further-reading>Further Reading</h1><p><strong>1.</strong> <a href=https://portswigger.net/burp>Burp</a><br><strong>2.</strong> <a href=https://portswigger.net/support/configuring-your-browser-to-work-with-burp>Burp Browser Configuration</a><br><strong>3.</strong> <a href=https://portswigger.net/support/checking-your-browser-proxy-configuration>Burp Proxy Configuration</a><br><strong>4.</strong> <a href=https://portswigger.net/support/installing-burp-suites-ca-certificate-in-your-browser>Burp Certificate</a><br><strong>5.</strong> <a href=https://portswigger.net/web-security/sql-injection/cheat-sheet>SQL Cheat Sheet</a><br><strong>6.</strong> <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection>SQL Payloads</a><br><strong>7.</strong> <a href=https://sqlmap.org/>SQLmap</a></p><h1 id=activities>Activities</h1><p><strong>1.</strong> <a href=https://sss-ctf.security.cs.pub.ro/challenges>Demo SQL Injection</a>
<strong>2.</strong> <a href=https://sss-ctf.security.cs.pub.ro/challenges>Blacklist</a>
<strong>3.</strong> <a href=https://sss-ctf.security.cs.pub.ro/challenges>Nightmare Store</a>
<strong>4.</strong> <a href=https://sss-ctf.security.cs.pub.ro/challenges>One by one</a>
<strong>5.</strong> <a href=https://sss-ctf.security.cs.pub.ro/challenges>T0p S3cr3t</a>
<strong>6.</strong> <a href=https://portswigger.net/web-security/sql-injection/lab-retrieve-hidden-data>Retrieve hidden data</a><br><strong>7.</strong> <a href=https://portswigger.net/web-security/sql-injection/lab-login-bypass>Login bypass</a><br><strong>8.</strong> <a href=https://portswigger.net/web-security/sql-injection/union-attacks/lab-determine-number-of-columns>Determine number of columns</a><br><strong>9.</strong> <a href=https://portswigger.net/web-security/sql-injection/union-attacks/lab-find-column-containing-text>Find column</a><br><strong>10.</strong> <a href=https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-data-from-other-tables>Retrieve data from other tables</a><br><strong>11.</strong> <a href=https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-multiple-values-in-single-column>Single column</a><br><strong>12.</strong> <a href=https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-oracle>What version?</a><br><strong>13.</strong> <a href=https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-mysql-microsoft>More versions</a><br><strong>14.</strong> <a href=https://portswigger.net/web-security/sql-injection/blind/lab-conditional-responses>Conditional responses</a><br><strong>15.</strong> <a href=https://portswigger.net/web-security/sql-injection/blind/lab-conditional-errors>Conditional errors</a><br><strong>16.</strong> <a href=https://portswigger.net/web-security/sql-injection/blind/lab-time-delays>Time delays</a><br><strong>17.</strong> <a href=https://portswigger.net/web-security/sql-injection/blind/lab-out-of-band>Out-of-band Application Security Testing</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-e8a4b127c58a39d643c27e9bb530772d>4 -</h1><h1 id=recon--enumeration--recap>Recon & Enumeration & Recap</h1><p>When it comes to hacking, knowledge is power.
The more knowledge you have about a target system or network, the more options you have available.
This session will put together all you have learned so far to give you an overview of how to approach a given target you want to exploit.
You will also find out about some more security tools that can help you automate the process.</p><h2 id=phases-of-penetration-testing>Phases of Penetration Testing</h2><p>Penetration testing is an authorized simulated cyber attack on a computer system, performed to evaluate its security.</p><p>A standard penetration testing flow implies 5 stages:</p><ol><li><strong>reconnaissance</strong> - gathering information about the target system: website technologies, subdomains, open ports, Google hacking</li><li><strong>scanning</strong> - manually or automatically (using tools) discovering vulnerabilities in the system, like SQL injection, XSS etc.</li><li><strong>gaining access</strong> using enumeration - exploiting the vulnerabilities found before to collect sensitive information: usernames, machine names, network information, service settings</li><li><strong>maintaining access</strong> - planting hidden programs (like Trojan horses) that make a future attack easier</li><li><strong>covering tracks</strong> - cleaning up all the signs that may lead to thinking that an attack happened</li></ol><p><img src=./assets/pentest_phases.png alt="Penetration testing phases"></p><p>Next, we introduce some popular tools that may help in the first three phases, to gather information about a target.
Exploiting Tools/ Security Testing Tools/ Penetration Testing Tools are used for the discovery of vulnerabilities without attempting to actually exploit them.</p><h1 id=1-reconnaissance>1. Reconnaissance</h1><p>Reconnaissance is an important first stage in any ethical hacking attempt.
Before it is possible to exploit a vulnerability in the target system, it is necessary to find it.
By performing reconnaissance on the target, an ethical hacker can learn about the details of the target network and identify potential attack vectors.</p><h2 id=nmap>Nmap</h2><p><a href=https://insecure.org/>Nmap</a> is probably the most well-known tool for active <strong>network</strong> reconnaissance.
It is a network scanner designed to determine details about a system and the programs running on it.</p><p>Every computer has a total of 65535 available ports; however, many of these are registered as standard ports.
For example, a HTTP web service can nearly always be found on port 80 of the server.
A HTTPS web service can be found on port 443.
If we do not know which of these ports a server has open, then we do not have a hope of successfully attacking the target; thus, it is crucial that we begin any attack with a port scan.
Nmap can be used to perform many different kinds of port scan; the basic theory is this: it will connect to each port of the target in turn.
Depending on how the port responds, it can be determined as being <em>open</em>, <em>closed</em>, or <em>filtered</em> (usually by a firewall).
Once we know which ports are open, we can then look at <em>enumerating</em> which services are running on each port – either manually, or more commonly using nmap.</p><p>Typing the simple command <code>nmap</code> will display all of its options for scanning, while <code>nmap &lt;target></code> will convert the hostname to an IP address and scan the top 1000 TCP ports, displaying their state and the service running on it:</p><p><img src=./assets/nmap_output.png alt="Nmap output"></p><p>You can see the full example <a href=https://nmap.org/book/port-scanning-tutorial.html>here</a> and practice more Nmap options <a href=https://tryhackme.com/room/rpnmap>here</a>.</p><h2 id=shodan>Shodan</h2><p><a href=https://www.shodan.io/>Shodan</a> is a search engine similar to Google.
But while Google searches for websites, Shodan searches for devices that are connected to the internet - from routers and servers, to Internet of Things (IoT) devices, such as thermostats and baby monitors, to complex systems that govern a wide range of industries, including energy, power, and transportation.
You can use a variety of search filters: port, IP address, city etc.
If your internet-facing devices aren’t protected, Shodan can tell hackers everything they need to know to break into your network.</p><h1 id=2-scanning>2. Scanning</h1><h2 id=owasp-zap>OWASP Zap</h2><p>The <a href=https://owasp.org/>Open Web Application Security Project</a> (OWASP) is a nonprofit foundation that works to improve the security of software.
The <a href=https://owasp.org/www-project-top-ten/>OWASP Top 10</a> is a standard awareness document for developers and web application security.
It represents a broad consensus about the most critical security risks to web applications and is updated every 3 years.</p><p>Developed by OWASP, <a href=https://www.zaproxy.org/>ZAP</a> or Zed Attack Proxy is a multi-platform, open source web application security testing tool. ZAP is used for finding a number of security vulnerabilities in a web app during the development as well as testing phase.
Other than its use as a scanner, ZAP can also be used to intercept a proxy for manually testing a web page.
ZAP can identify:</p><ul><li>Application error disclosure</li><li>Cookie not marked with the HttpOnly flag</li><li>Missing anti-CSRF tokens and security headers</li><li>Private IP disclosure</li><li>Session ID in URL rewrite</li><li>SQL injection</li><li>XSS injection</li></ul><p>You can read about other active recon tools <a href=https://resources.infosecinstitute.com/topic/top-10-network-recon-tools/#gref>here</a>: Nessus, OpenVAS, Nikto, Metasploit, <a href=https://pentest-tools.com/website-vulnerability-scanning/website-scanner>Pentest-Tools Website Scanner</a>.</p><h1 id=3-enumeration>3. Enumeration</h1><h2 id=extracting-common-passwords---burp-intruder>Extracting common passwords - Burp Intruder</h2><p>You were introduced to Burp Proxy in an earlier session.
Now we&rsquo;ll see an example of how to use Intruder in order to enumerate passwords.
With Burp Intruder, customized attacks can be automated against web applications.
Customizing attacks requires that we specify one or more payloads and the position where the payloads will be placed in the website.</p><ul><li>I opened Burp and the built-in Chromium browser (or your browser of choice, but pay attention to setting up the proxy), having the intercept <strong>off</strong>.</li><li>I navigated to <a href=https://sss-ctf.security.cs.pub.ro/home>https://sss-ctf.security.cs.pub.ro/home</a> and tried to log in using the email <strong><a href=mailto:a@a.com>a@a.com</a></strong> and the password <strong>abc123</strong>.</li><li>The POST request can be found in HTTP history. Right click on it to send it to Intruder.</li></ul><p><img src=./assets/send_to_intruder.png alt="Send request to Burp Intruder"></p><ul><li>Let&rsquo;s say we want to try all the passwords from <strong>abc1</strong>, <strong>abc3</strong>, <strong>abc5</strong>&mldr; to <strong>abc100</strong>. Navigate to the <strong>Positions</strong> tab - the payload position is specified with a pair of these characters: <strong>§</strong> called <strong>payload markers</strong>.</li></ul><p><strong>Note!</strong> By default, Burp surrounds by default some parameter values which might be candidates for enumeration, such as cookie values, or POST data values.
Remove the extra <strong>§</strong> characters, leaving it like in the picture below.</p><p><img src=./assets/payload_position.png alt="Set payload position"></p><ol><li>Our payload type (wordlist) is a sequence of numbers which can be automatically generated in Burp. Go to the <strong>Payloads</strong> tab and select <strong>Numbers</strong> as the <strong>Payload type</strong>.</li><li>Fill in the Payload options to generate all the numbers from 1 to 100, with step 2 (1, 3, 5&mldr;).</li><li>Finally, launch the attack.</li></ol><p><img src=./assets/payload_type.png alt="Set payload type"></p><p>A new window opens and you can see all the requests Burp is making, with the payloads you specified.
For example, you can check the request corresponding to the payload 7, with the resulting password being <strong>abc7</strong>, and you can observe the response, its status code, or even open it in the browser.</p><p><img src=./assets/attack_example.png alt="Attack example"></p><p>There are many ways in which you can customize this process according to your needs.
You can have multiple payload positions and select from four attack types, specifying how to insert the payloads (one different wordlist for each position, or combinations of them).
Find more details <a href=https://portswigger.net/burp/documentation/desktop/tools/intruder/positions>here</a>.</p><ul><li><strong>Sniper</strong> - This uses a single set of payloads.
It targets each payload position in turn, and places each payload into that position in turn.
Positions that are not targeted for a given request are not affected - the position markers are removed and any enclosed text that appears between them in the template remains unchanged.
This attack type is useful for fuzzing a number of request parameters individually for common vulnerabilities.
The total number of requests generated in the attack is the product of the number of positions and the number of payloads in the payload set.</li><li><strong>Battering ram</strong> - This uses a single set of payloads.
It iterates through the payloads, and places the same payload into all of the defined payload positions at once.
This attack type is useful where an attack requires the same input to be inserted in multiple places within the request (e.g. a username within a Cookie and a body parameter).
The total number of requests generated in the attack is the number of payloads in the payload set.</li><li><strong>Pitchfork</strong> - This uses multiple payload sets.
There is a different payload set for each defined position (up to a maximum of 20).
The attack iterates through all payload sets simultaneously, and places one payload into each defined position.
In other words, the first request will place the first payload from payload set 1 into position 1 and the first payload from payload set 2 into position 2; the second request will place the second payload from payload set 1 into position 1 and the second payload from payload set 2 into position 2, etc.
This attack type is useful where an attack requires different but related input to be inserted in multiple places within the request (e.g. a username in one parameter, and a known ID number corresponding to that username in another parameter).
The total number of requests generated in the attack is the number of payloads in the smallest payload set.</li><li><strong>Cluster bomb</strong> - This uses multiple payload sets.
There is a different payload set for each defined position (up to a maximum of 20).
The attack iterates through each payload set in turn, so that all permutations of payload combinations are tested. I.e., if there are two payload positions, the attack will place the first payload from payload set 2 into position 2, and iterate through all the payloads in payload set 1 in position 1; it will then place the second payload from payload set 2 into position 2, and iterate through all the payloads in payload set 1 in position 1.
This attack type is useful where an attack requires different and unrelated or unknown input to be inserted in multiple places within the request (e.g. when guessing credentials, a username in one parameter, and a password in another parameter).
The total number of requests generated in the attack is the product of the number of payloads in all defined payload sets - this may be extremely large.</li></ul><p>There are also many different types of payloads you can use (<a href=https://portswigger.net/burp/documentation/desktop/tools/intruder/payloads/types>here</a> is the entire list), from specifying your own list of words to generating random bytes.
You can find lists of popular credentials online, for instance, <a href=https://github.com/danielmiessler/SecLists/tree/master/Passwords>here</a> is a repo with lists of most used passwords.</p><h2 id=web-content-enumeration-web-content-discovery-dirbusting>Web Content Enumeration/ Web Content Discovery/ Dirbusting</h2><p>Let&rsquo;s say we have the target server <strong><a href=https://security.cs.pub.ro/>https://security.cs.pub.ro/</a></strong> and we want to discover hidden files, directories or other resources there.
Manually, we would make multiple requests like _<a href=https://security.cs.pub.ro/docs_,>https://security.cs.pub.ro/docs_,</a> _<a href=https://security.cs.pub.ro/config.php_>https://security.cs.pub.ro/config.php_</a> etc. or whatever we imagine might find and see if we get a 404 Not Found response or not.
Luckily, there are command line tools and predefined wordlists in Kali (<strong>/usr/share/wordlists/</strong>) doing exactly this for us.</p><h3 id=dirb>DIRB</h3><p><a href=https://tools.kali.org/web-applications/dirb>DIRB</a> is a Web Content Scanner, a Kali built in tool.
It looks for existing (and/or hidden) Web Objects.
It basically works by launching a dictionary based attack against a web server and analyzing the response.
DIRB comes with a set of preconfigured attack wordlists for easy usage but you can use your custom wordlists.
For each filename, it checks the existence on the web server and returns the results which do not give a 404 Not Found response.</p><p>Usage example: <code>./dirb &lt;url_base> [&lt;wordlist_file(s)>] [options]</code></p><p><img src=./assets/dirb_example.png alt="DIRB example"></p><p>The output lines with the results found (not 404) start with a <code>+</code> and give details about status code and page size.</p><p>You can read the documentation if you want to specify custom options, like custom file extensions to look for.</p><h3 id=similar-tools>Similar tools</h3><ul><li><a href=https://tools.kali.org/web-applications/dirbuster>DirBuster</a> - not maintained anymore, Kali built in, written in Java.
The only one with a GUI and not a CLI.</li><li><a href=https://www.kali.org/tools/dirsearch/>DirSearch</a> - Kali built in & on <a href=(https://github.com/maurosoria/dirsearch)>GitHub</a>, written in Python.</li><li><a href=https://tools.kali.org/web-applications/gobuster>GoBuster</a> - Kali built in & on <a href=https://github.com/OJ/gobuster>GitHub</a>, written in Go.
Can do DNS and VHost busting, S3 buckets enumeration.</li><li><a href=https://github.com/xmendez/wfuzz>wfuzz</a> - on GitHub, written in Python, can be easily installed with pip.</li><li><a href=https://github.com/ffuf/ffuf>ffuf</a> - on GitHub, written in Go, has the option to mutate the files found.
Can do VHost discovery.</li></ul><p>You can find a detailed comparison <a href=https://blog.sec-it.fr/en/2021/02/16/fuzz-dir-tools/>here</a>.
We don&rsquo;t recommend DirBuster and DirSearch since the others are newer, improved and better-maintained tools.
DIRB is also not maintained anymore, but can come in handy if you want to do a quick content discovery, with not many options to configure.</p><h2 id=recap-with-dvwa>Recap with DVWA</h2><p>DVWA (Damn Vulnerable Web Application) is a deliberately vulnerable application which you can use to test your skills and exploit some of the most common web vulnerabilities, like XSS, SQL, LFI, with various difficulty levels.</p><h3 id=setup-instructions>Setup instructions</h3><p>An easy way to deploy DVWA is by using <a href=https://docs.docker.com/get-docker/>Docker</a>, which you need to have installed on your machine.
Then, follow the instructions from <a href=https://hub.docker.com/r/vulnerables/web-dvwa/>here</a>.
After running it, you can simply access it in your browser at http://127.0.0.1:80 (or a different port, if you wish), login and start hacking.</p><h3 id=solutions>Solutions</h3><ul><li>Brute force: <a href=https://medium.com/cyberdefendersprogram/burp-suite-webpage-enumeration-and-vulnerability-testing-cfd0b140570d>https://medium.com/cyberdefendersprogram/burp-suite-webpage-enumeration-and-vulnerability-testing-cfd0b140570d</a></li><li>SQL Injection: <a href=https://medium.com/cyberdefendersprogram/burp-suite-webpage-enumeration-and-vulnerability-testing-cfd0b140570d>https://medium.com/cyberdefendersprogram/burp-suite-webpage-enumeration-and-vulnerability-testing-cfd0b140570d</a></li><li>Blind Sql: <a href=https://medium.com/hacker-toolbelt/dvwa-1-9-viii-blind-sql-injection-with-sqlmap-ee8d59fbdea7>https://medium.com/hacker-toolbelt/dvwa-1-9-viii-blind-sql-injection-with-sqlmap-ee8d59fbdea7</a></li><li>CSRF: <a href=https://medium.com/hacker-toolbelt/dvwa-1-9-iv-csrf-b9f2409fd628>https://medium.com/hacker-toolbelt/dvwa-1-9-iv-csrf-b9f2409fd628</a></li><li>File Upload: <a href=https://medium.com/hacker-toolbelt/dvwa-1-9-vi-file-upload-ce77a73b0453>https://medium.com/hacker-toolbelt/dvwa-1-9-vi-file-upload-ce77a73b0453</a></li></ul><h1 id=further-reading>Further Reading</h1><ul><li><a href=https://www.safetydetectives.com/blog/what-is-shodan-and-how-to-use-it-most-effectively/>https://www.safetydetectives.com/blog/what-is-shodan-and-how-to-use-it-most-effectively/</a></li><li><a href=https://hackr.io/blog/top-10-open-source-security-testing-tools-for-web-applications>https://hackr.io/blog/top-10-open-source-security-testing-tools-for-web-applications</a></li><li><a href=https://www.knowledgehut.com/blog/security/enumeration-in-ethical-hacking>https://www.knowledgehut.com/blog/security/enumeration-in-ethical-hacking</a></li><li><a href=https://www.greycampus.com/opencampus/ethical-hacking/enumeration-and-its-types>https://www.greycampus.com/opencampus/ethical-hacking/enumeration-and-its-types</a></li></ul><h3 id=wordlists>Wordlists</h3><ul><li><a href=https://github.com/Bo0oM/fuzz.txt>https://github.com/Bo0oM/fuzz.txt</a></li><li><a href=https://github.com/aels/subdirectories-discover>https://github.com/aels/subdirectories-discover</a></li><li><a href=https://github.com/danielmiessler/SecLists>https://github.com/danielmiessler/SecLists</a></li></ul><h3 id=bug-bounty-program-lists>Bug Bounty Program Lists</h3><ul><li><a href=https://github.com/projectdiscovery/public-bugbounty-programs/blob/master/chaos-bugbounty-list.json>https://github.com/projectdiscovery/public-bugbounty-programs/blob/master/chaos-bugbounty-list.json</a></li><li><a href=https://www.bugcrowd.com/bug-bounty-list/>https://www.bugcrowd.com/bug-bounty-list/</a></li><li><a href=https://hackerone.com/bug-bounty-programs>https://hackerone.com/bug-bounty-programs</a></li></ul><h1 id=activities>Activities</h1><ol><li><a href=https://sss-web.cyberedu.ro/challenge/268a2910-02d8-11ed-9675-abf36c35783f>Not So Random</a></li><li><a href=https://sss-web.cyberedu.ro/challenge/7ba65330-02d8-11ed-9270-29119375f24f>Lamer Login</a></li><li><a href=https://hub.docker.com/r/vulnerables/web-dvwa/>DVWA</a></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-fca1ee26cbdcd099d45b25d743b89e27>5 -</h1><h1 id=introduction>Introduction</h1><p>Application programming interfaces (APIs) and frameworks have become a critical part of almost every business.
APIs are responsible for transferring information between systems within a company or to external companies.
API may be a system API or a library API.
Here we talk about web APIs, i.e. APIs provided by web applications.
APIs are means through which a client accesses remote services.
For example, when you log in to a website like Google or Facebook, an API processes your login credentials to verify they are correct.
A framework, or software framework, is a platform for developing software applications.
It provides a foundation on which software developers can build programs for a specific platform.
For example, a framework may include predefined classes and functions that can be used to process input, manage hardware devices, and interact with system software.</p><p>However, given the sensitive data being transferred through APIs, it’s critical to secure them.
Moreover, from time to time people find vulnerabilities for versions of widely used frameworks, which puts numerous web apps at risk.
Therefore, it&rsquo;s best to be up to date and apply security patches as soon as a new vulnerability arises.</p><h1 id=api-vulnerabilities>API Vulnerabilities</h1><p>By nature, APIs expose application logic and sensitive data such as Personally Identifiable Information (PII) and because of this have increasingly become a target for attackers.
PII is any data that could potentially be used to identify a particular person.
Examples include a full name, Social Security number, driver&rsquo;s license number, bank account number, passport number, and email address.</p><h2 id=broken-object-level-authorization>Broken Object Level Authorization</h2><p>An object refers to a data source that is associated with an authenticated entity.
Object-level authorization is all about controlling access based on the scope of permissible user data and object access.
A simple physical world example is a hotel room key which is coded to only open the room you paid for, as opposed to a master key used by a maid that opens all the rooms on the floor.
Attackers can exploit API endpoints that are vulnerable to broken object level authorization by manipulating the ID of an object that is sent within the client request.
What this means is that the client can request information from an API endpoint that they are not supposed to have access to.
This attack normally leads to unauthorized information disclosure, modification, or destruction of data.</p><p><strong>Example Attack Scenario:</strong></p><p>Say for instance there is an e-commerce platform that provides financial and hosted services to a group of different online stores (shops).
The platform provides an API used to gain access to revenue charts for each of their hosted stores, and each store should only have access to their own revenue charts.
However, while inspecting the client request from a single store that wants to gain access to their own revenue charts, an attacker can identify (find) the API endpoint for those revenue charts and identify the URL in use, for example <code>/shops/{shop name}/revenue_data.json</code>.
Using the names of other stores being hosted on the e-commerce platform, an attacker can create a simple script to modify the <code>{shop name}</code> ID object in subsequent requests, and gain access to the revenue charts of every other store.</p><h2 id=broken-authentication>Broken Authentication</h2><p>Being different from Authorization discussed above, Authentication on the other hand is a complex and confusing mechanism concerning APIs.
Since authentication endpoints are exposed to anyone by design, the endpoints that are responsible for user-authentication must be treated differently from regular API endpoints and implement extra layers of protection for credential stuffing attempts, in addition to brute force password and token guessing attacks.</p><p><strong>Example Attack Scenario:</strong></p><p>Suppose that an attacker obtained a list of leaked username/password combinations as the result of a data breach from another organization.
If the API endpoint handling authentication does not implement brute force or credential stuffing protections like CAPTCHA, rate-limiting, account lockout, etc., an attacker can repeatedly attempt to gain access using the list of username/password combinations to determine what combination(s) work.</p><h2 id=excessive-data-exposure>Excessive Data Exposure</h2><p>By design, API endpoints often expose sensitive data since they frequently rely on the client app to perform data filtering.
Attackers exploit this issue by sniffing the traffic to analyze the responses, looking for sensitive data that should not be exposed.
This data is supposed to be filtered on the client app, before being presented to the user.</p><p><strong>Example Attack Scenario:</strong></p><p>Imagine that an IoT-based camera surveillance system allows administrators to add a newly-hired security guard as a system user, and the administrator wants to ensure the new user should only have access to certain cameras.
These cameras are accessible via a mobile app that the security guard uses while at work.
The newly hired security guard’s mobile app makes an API request to an endpoint in order to receive data about the cameras, and relies on the mobile app to filter which cameras the guard has access to.
Although the mobile app only shows the cameras the guard can access, the actual API response contains a full list of all the cameras.
Using the sniffed traffic, an attacker can manipulate the API request to show all cameras, bypassing the filtering on the mobile app.</p><h2 id=lack-of-resources--rate-limiting>Lack of Resources & Rate Limiting</h2><p>It is common to find API endpoints that do not implement any sort of rate limiting on the number of API requests, or they do not limit the type of requests that can consume considerable network, CPU, memory, and storage resources.
The amount of resources required to satisfy a request greatly depends on the user input and endpoint business logic.
Attackers exploit these issues causing denial-of-service attacks and associated endpoint outages.</p><p><strong>Example Attack Scenario:</strong></p><p>Let’s say that an attacker wants to cause a denial-of-service outage to a certain API that contains a very large list of users.
The users’ list can be queried, but the application limits the number of users that can be displayed to 100 users.
A normal request to the application would look like this: <code>/api/users?page=1&size=100</code>.
In this case, the request would return with the first page and the first 100 users.
If the attacker changed the size parameter from 100 to 200000, it could cause a performance issue on the backend database, since the size parameter in use is so large.
As a result, the API becomes unresponsive and is unable to handle further requests from this or any other client.</p><h2 id=broken-function-level-authorization>Broken Function Level Authorization</h2><p>Although different from Broken Object Level Authorization (described above), exploitation of this issue requires the attacker to send API requests to endpoints that they should not have access to, yet are exposed to anonymous users or regular, non-privileged users.
These types of flaws are often easy to find and can allow attackers to access unauthorized functionality.
For example, administrative functions are prime targets for this type of attack.</p><p><strong>Example Attack Scenario:</strong></p><p>To illustrate this further, imagine that during the registration process to a certain application that only allows invited users to join, the mobile app triggers an API request to GET /api/invites/{invite_guid}.
GET is a standard HTTP method used to request information from a particular resource.
In this case, the response to the GET contains details about the invite, including the user’s role and email address.</p><p>Now, say that an attacker duplicated the request and manipulated the HTTP method by changing GET to POST.
POST is a HTTP method used to send information to create or update a resource.
The URL would look like this: <code>POST /api/invites/new/{“email”:”hugo@malicious.com”,”role”:”admin”}</code>.
In this case, the attacker easily exploits this issue and sends himself an email invite to create an admin account.</p><h2 id=mass-assignment>Mass Assignment</h2><p>Modern frameworks encourage developers to use functions that automatically bind input from the client into code variables and internal objects.
What this means is that users should have the ability to update their username, contact details, etc. (within their profiles for example), but they should not be able to change their user-level permissions, adjust account balances, and other administrative-like functions.
An API endpoint is considered vulnerable if it automatically converts the client input into internal object properties, without considering the sensitivity and the exposure level of these properties.
This could allow an attacker to update things that they should not have access to.</p><p><strong>Example Attack Scenario:</strong></p><p>To illustrate this further, imagine that a ride sharing application provides the user the option to edit basic information about themselves in their user profile.
For example, they can adjust their username, age etc.
In this case, the API request would look like this: <code>PUT /api/v1/users/me</code> with the following legitimate information:</p><p><code>{"username":"john","age":24}</code></p><p>However, the attacker determines that the request <code>GET /api/v1/users/me</code> includes an additional credit_balance property (field) as shown below.</p><p><code>{"username":"john","age":24,"credit_balance":10}</code></p><p>The attacker desires to increase their credit balance on their own and replays the first request with the following payload:</p><p><code>{"username":"john","age":24,"credit_balance":99999}</code></p><p>Since the endpoint is vulnerable to mass assignment, the attacker can easily adjust their own <code>credit_balance</code> at will, for example changing it from 10 credits to 99999 as shown above.</p><h2 id=security-misconfiguration>Security Misconfiguration</h2><p>Attackers will often attempt to find unpatched flaws, common endpoints, or unprotected files and directories to gain unauthorized access or knowledge of the system they want to attack.
Security misconfigurations can not only expose sensitive user data, but also system details that may lead to full server compromise.</p><p><strong>Example Attack Scenario:</strong></p><p>Say for instance that an attacker uses a popular search engine like Shodan to search for computers and devices directly accessible from the Internet.
The attacker found a server running a popular database management system, listening on the default TCP port.
The database management system was using the default configuration, which has authentication disabled by default, and the attacker gained access to millions of records with PII, personal preferences, and authentication data.</p><h2 id=injection>Injection</h2><p>Injection flaws, such as SQL, NoSQL, command injection, etc., occur when untrusted data is sent to an interpreter as part of a command or query.
Injection vulnerabilities cause computing systems to potentially process malicious data that attackers introduce.
To put it in its simplest terms, attackers inject code into a vulnerable piece of software and change the way the software is intended to be executed.
As a result, injection attacks can be somewhat disastrous, since they normally lead to data theft, data loss, data corruption, denial of service, etc.</p><p><strong>Example Attack Scenario:</strong></p><p>Suppose an attacker starts inspecting the network traffic of their web browser and identifies the following API request designed to help a user recover their password.
The attacker identifies the request responsible to start the recovery-password process as follows:</p><p><code>POST /api/accounts/recovery {“email”: “john@somehost.com”}</code></p><p>Then the attacker replays the request with a different payload:</p><p><code>POST /api/account/recovery {“email”: “john@somehost.com’;WAITFOR DELAY ‘0:0:5’–“}</code></p><p>By adding the <code>;WAITFOR DELAY ‘0:0:5’–”</code> the attacker observes that the response from the API took ~5 seconds longer, which helps confirm the API is vulnerable to SQL injection.
Exploiting the injection vulnerability, the attacker was able to gain unauthorized access to the system.</p><h2 id=improper-assets-management>Improper Assets Management</h2><p>Old API versions are often unpatched and can become an easy way to compromise systems without having to fight state-of-the-art security systems, which might be in place to protect the most recent API versions.
Attackers may gain access to sensitive data, or even take over the server through old, unpatched API versions connected to the same database.</p><p><strong>Example Attack Scenario:</strong></p><p>Say for instance that an organization redesigning their applications forgot about an old API version (api.someservice.com/v1) and left it unprotected, and with access to the user database.
While targeting one of the latest released applications, an attacker found the API address (api.someservice.com/v2).
Replacing v2 with v1 in the URL gave the attacker access to the old, unprotected API, exposing the personal identifiable information (PII) of millions of users.</p><h2 id=insufficient-logging--monitoring>Insufficient Logging & Monitoring</h2><p>Without logging and monitoring, or with insufficient logging and monitoring, it is almost impossible to track suspicious activities targeting APIs and respond to them in a timely fashion.
Without visibility over ongoing malicious activities, attackers have plenty of time to potentially compromise systems and steal data.
Most breach studies demonstrate the time to detect a breach is over 200 days, typically detected by external parties rather than internal processes or monitoring.</p><p><strong>Example Attack Scenario:</strong></p><p>Imagine that a video-sharing platform was hit by a &ldquo;large-scale&rdquo; credential stuffing attack.
Despite failed logins being logged, no alerts were triggered during the timespan of the attack, and it proceeded without being noticed.
As a reaction to user complaints about a possible breach, API logs were analyzed and the attack was detected, way after the fact.
The company had to make a public announcement asking users to reset their passwords, and report the incident to their regulatory authorities.</p><h1 id=framework-vulnerabilities>Framework Vulnerabilities</h1><p>Web application framework is a collection of pieces of software designed to ease the development of web applications.
Web application frameworks provide common solutions for a wide variety of tasks such as database access, input filtering for security purposes, authentication, session handling and templates for website development.</p><p>There are several different types of web application frameworks:</p><ul><li>General purpose website frameworks (Ruby On Rails)</li><li>Discussion forums, wikis and weblogs (WikiBase/WikiWikiWeb)</li><li>Organizational portals (JBoss Portal)</li><li>Content Management Systems (CMS) (Joomla, Drupal, Wordpress)</li></ul><p>When performing a security audition (or hacking) of a website it is necessary to identify the implementation technologies of the target.
This identification can be done manually or more commonly using automated tools, such as <a href=https://builtwith.com/>BuiltWith</a> and <a href=https://www.wappalyzer.com/>Wappalyzer</a>.
Once the web application framework is detected further penetration steps depend on the framework.
Quite a few websites are done with CMSs and contain no application-specific custom code.
For these applications, identifying the CMSs modules used and their version is necessary.
This information can be used further to search for vulnerabilities or perform a manual code inspection of the modules used.
Finding a security flaw usually means that the website has not been properly updated.
If a manual inspection of CMS modules reveals vulnerabilities, it is very likely that these modules are used in other websites, which makes them vulnerable as well.</p><p>The most widely used web Frameworks provide lots of security mechanisms by default - for example, Django provides protection for SQL injection, XSS injection, clickjacking and many more.
However, from time to time vulnerabilities are found and attackers have numerous possible targets, since some of these frameworks are extremely popular.</p><p>The rest of the section contains examples of vulnerabilities found in various framework versions.</p><h2 id=laravel>Laravel</h2><p>Laravel is one of the <a href=https://customerthink.com/what-makes-laravel-the-most-preferred-php-framework-for-web-development/>most preferred</a> PHP Frameworks for Web Development.</p><p>In 2019 a vulnerability was found for the popular Laravel-query-builder package.
Due to the way Laravel builder parses the string to query, the hacker can leverage this to attack the application with an SQL Injection attack.</p><p>The package is parsing the URLs to add some filters to the queries.</p><p>For example, if you want to sort the articles by title:</p><p><code>https://example.com/articles?sort=title</code></p><p>You may use the following code to automatically sort by the package:</p><pre><code>use Spatie\QueryBuilder\QueryBuilder;
$articles = QueryBuilder::for(Article::class)-&gt;get();
</code></pre><p>This will be translated into:</p><p><code>Article::orderBy('title')->get();</code></p><p>And the underlined SQL query will be:</p><p><code>SELECT * FROM 'articles' ORDER BY 'title' ASC</code></p><p>The attacker can take advantage of this transformation to perform an SQL Injection attack, by changing the URL to:</p><p><code>https://example.com/articles?sort=title->"%27))injectedSQL</code></p><p>Since Laravel supports queries in JSON fields, it will guess that you want to query json <code>title-></code> so it replaces <code>-></code> with JSON MySQL functions.
The attacker closes the function brackets <code>))</code> and adds his injected SQL.</p><p>The final command:</p><p><code>SELECT * FROM articles ORDER BY json_unquote(json_extract(title, '$.""'))</code><strong><code>injectedSQL</code></strong><code>"')) ASC</code></p><p><strong>Vulnerable versions:</strong></p><p>Laravel 5.6/5.7/5.8 with Laravel-query-builder &lt; v1.17.1
Laravel 5.5 with Laravel-query-builder &lt; v1.16.1</p><h2 id=drupal>Drupal</h2><p>Drupal is a free and open-source web content management framework written in PHP.
Drupal provides a back-end framework for at least 2.3% of all websites worldwide – ranging from personal blogs to corporate, political, and government sites.
According to builtwith.com, 473 of the Quantcast top 10,000 websites use Drupal, and that number jumps up to 4,341 when you look at the top 100,000.</p><p>Drupal introduced a Form API in Drupal 6 which allowed alteration of the form data during the form rendering process.
In 2018, Drupal released a patch adding just a single class, <em>RequestSanitizer</em>, with a <em>stripDangerousValues</em> method that resets all the items in an input array for keys that start with a hash sign.
This method sanitizes input data in $_GET, $_POST & $_COOKIES during the very early stages of Drupal’s bootstrap (immediately after loading the site configurations).
It can be assumed that the reason why the patch was released is to make an existing vulnerability harder to find.</p><p>The vulnerability was found in the forms.
The user registration form which requires no authentication and can be accessed anonymously contains multiple input fields and can be exploited.</p><p><img src=./assets/drupal1.png alt="Form Fields"></p><p>It was highly probable that injecting a renderable array would exploit the vulnerability, the question was where?</p><p>As it turns out, the “Email Address” field doesn’t sanitize the type of input it receives which allows hackers to inject the renderable array to the form array structure.
Renderable arrays contain metadata that is used in the rendering process.</p><p><img src=./assets/drupal2.png alt="Injected Array"></p><p>Since Drupal treats the injected array as a value and not as an element, attackers need to trick Drupal into rendering it.
Drupal renders an array on page load events or via Drupal AJAX API.</p><p>The &ldquo;Picture&rdquo; field of the user registration form uses Drupal’s AJAX API to upload a picture and replace it with a thumbnail of the uploaded image.</p><p>What&rsquo;s more important about this attack is that a Russian Security Researcher posted a <a href=https://github.com/a2u/CVE-2018-7600/blob/master/exploit.py>POC</a> on Github and soon after numerous people started using it to install cryptocurrency miners and malware backdoors.</p><p><strong>Vulnerable versions:</strong></p><p>Drupal &lt; 8.3.9 / &lt; 8.4.6 / &lt; 8.5.1 ~ user/register URL, attacking account/mail & #post_render parameter, using PHP&rsquo;s passthru function
Drupal &lt; 7.58 ~ user/password URL, attacking triggering_element_name form & #post_render parameter, using PHP&rsquo;s passthru function</p><h2 id=wordpress>WordPress</h2><p>Details of a serious Denial of Service (DoS) vulnerability in WordPress have been published by an Israeli security researcher named Barak Tawily.
This vulnerability can be used to take down a website in a matter of minutes.</p><p>The vulnerability is listed on the CVE (Common Vulnerabilities and Exposures) website as CVE-2018-6389 and on Exploit DB as exploit number 43968.
Barak Tawily first wrote about it on February 5, 2018 on his blog.</p><p>This issue is related to a file called load-scripts.php, which is a part of the WordPress core.
This file is used to improve the performance by loading multiple external JavaScript (JS) files in a single request.</p><p>Barak first noticed the problem when he saw an unusual URL that was loading when he visited certain WordPress pages.
That URL was:</p><p><code>https://DOMAINNAME/wp-admin/load-scripts.php?c=1&load%5B%5D=jquery-ui-core&ver=4.9.1</code></p><p>He noticed that the load-scripts.php file was receiving a parameter called load[].
This parameter is an array that was receiving the names of the JS files that needed to be loaded.
In this case, it was receiving jQuery UI Core, which is the name of one of the Javascript files used by the WordPress login page.</p><p>Because WordPress is an open source platform, it was simple for Barak to review the application’s code and determine precisely how WordPress loaded these files.
He discovered that load-scripts.php file was designed to economize the loading of external JS files.
Another file, called load-styles.php, was doing the same thing for Cascading Style Sheet (CSS) files.</p><p>This feature allowed the browser to receive multiple files with a single request, dramatically improving the load time of each admin page.
Although it was only designed for use on admin pages, it was also being used on the login page — before the user had been authenticated.
This oversight is responsible for the vulnerability.</p><p>He continued to explore the source code of WordPress and discovered that there is a variable that contains a defined list of scripts that can be loaded.
If one of the names in the load[] array matches one of these script names, the server will perform an I/O read action to load it.
The list of scripts that are available is defined in a file called script-loader.php.
It includes 181 different scripts.
The server took ~2.2 seconds to gather the files, merge them into one file, and send them to the browser.
After performing 500 requests, the server was overloaded and became unable to respond to subsequent requests.
He posted a <a href="https://www.youtube.com/watch?v=nNDsGTalXS0&feature=youtu.be">video</a> showing how quickly it could be used to take down a WordPress website.</p><h3 id=wpscan>WPScan</h3><p>The <a href=https://wpscan.com/wordpress-security-scanner>WPScan</a> CLI tool is a free, for non-commercial use, black box WordPress security scanner written for security professionals and blog maintainers to test the security of their sites.
The WPScan CLI tool uses a database of WordPress vulnerabilities - from WordPress versions, plugins, themes etc.</p><h1 id=further-reading>Further Reading</h1><ul><li>Metropolia University of Applied Sciences</li><li><a href=https://blog.papertrailapp.com/common-api-vulnerabilities-and-how-to-secure-them/>https://blog.papertrailapp.com/common-api-vulnerabilities-and-how-to-secure-them/</a></li><li><a href=https://techterms.com/definition/framework>https://techterms.com/definition/framework</a></li><li><a href=https://owasp.org/www-project-api-security/>https://owasp.org/www-project-api-security/</a></li><li><a href=https://www.checkmarx.com/blog/breaking-down-owasp-api-security-top10-part1>https://www.checkmarx.com/blog/breaking-down-owasp-api-security-top10-part1</a></li><li><a href=https://securityboulevard.com/2020/01/breaking-down-the-owasp-api-security-top-10-part-2/>https://securityboulevard.com/2020/01/breaking-down-the-owasp-api-security-top-10-part-2/</a></li><li><a href=https://shieldfy.io/blog/serious-sql-injection-vulnerability-in-laravel-query-builder/>https://shieldfy.io/blog/serious-sql-injection-vulnerability-in-laravel-query-builder/</a></li><li><a href=https://research.checkpoint.com/2018/uncovering-drupalgeddon-2/>https://research.checkpoint.com/2018/uncovering-drupalgeddon-2/</a></li><li><a href=https://www.secpod.com/blog/drupalgeddon-2/>https://www.secpod.com/blog/drupalgeddon-2/</a></li><li><a href=https://blog.threatpress.com/wordpress-vulnerability-dos/>https://blog.threatpress.com/wordpress-vulnerability-dos/</a></li><li><a href=https://freek.dev/1317-an-important-security-release-for-laravel-query-builder>https://freek.dev/1317-an-important-security-release-for-laravel-query-builder</a></li></ul><h1 id=activities>Activities</h1><ul><li><a href=https://sss-web.cyberedu.ro/challenge/ca1512a0-0616-11ed-be56-0fec9572decd>Clean up</a></li><li><a href=https://sss-web.cyberedu.ro/challenge/f2efab30-0616-11ed-bb34-19a4ff512c6d>High Score</a></li><li><a href=https://sss-web.cyberedu.ro/challenge/0cb44c00-0617-11ed-80ab-4758bca0c77e>Snoop Doggy Dogg</a></li><li><a href=https://sss-web.cyberedu.ro/challenge/2026cea0-0617-11ed-8d3f-19288a331f73>The Accountant</a></li><li><a href=https://github.com/vavkamil/dvwp>Damn Vulnerable WordPress</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-cd5bf7687b4a925bb14ff76ea1daabd5>6 -</h1><h1 id=cross-site-scripting-xss>Cross-site Scripting (XSS)</h1><h2 id=intro>Intro</h2><p>Cross-site Scripting (XSS) is a web security vulnerability that allows an attacker to inject malicious code, usually JavaScript, in the web browser of the victim. This implies that the attacker can do a lot of damage from stealing data to perform actions on behalf of the user. This type of vulnerability implies that the web application uses the user input in the HTML page that it serves. As opposed to other types of code injections, the malicious code in an XSS will always run on the client-side shifting the target from the server hosting the application to the users of the application.</p><h2 id=impact>Impact</h2><p>The impact of the vulnerability is linked with the functionality that the web application provides. If the app is doesn&rsquo;t have much functionality (e.g. a news website) the attacker might not obtain much, but if it&rsquo;s a banking app, there is certainly something to obtain.</p><p>Cross-site Scripting can be used to achieve a lot of things:</p><ul><li>steal data - sensitive data as login credentials or credit card numbers</li><li>hijack the session of the user - get the user&rsquo;s session token and browse the application as it&rsquo;s your account without any credentials</li><li>track user movements - keylogging, taking screenshots of the page</li><li>perform actions on behalf of the user - sending payments to attacker&rsquo;s account</li><li>alter the looks of the HTML page (virtual defacement) - fake the balance of the account while the attacker steals the money</li><li>mining - placing a cryptocurrency miner in the page while the user reads a long article</li><li>if that&rsquo;s not enough, you may find more ideas <a href=http://www.xss-payloads.com/payloads.html>here</a>.</li></ul><h2 id=types>Types</h2><p>There are mainly three types of XSS:</p><ul><li>Reflected XSS</li><li>Stored XSS</li><li>DOM XSS</li></ul><h3 id=reflected-xss>Reflected XSS</h3><p>Reflected XSS or non-persistent is the simplest form of XSS and occurs when user input is immediately returned by the web application in the HTTP response.</p><p><img src=../05-injection-2/support/reflected-xss.png alt="Reflected XSS Steps"></p><p><img src=../05-injection-2/support/XSS_reflected.gif alt="Reflected XSS steps"></p><ol><li>The attacker crafts a URL containing a malicious string and sends it to the victim.</li><li>The victim is tricked by the attacker into requesting the URL from the website.</li><li>The website includes the malicious string from the URL in the response.</li><li>The victim&rsquo;s browser executes the malicious script inside the response, sending the victim&rsquo;s cookies to the attacker&rsquo;s server.</li></ol><h4 id=example>Example</h4><p>Let&rsquo;s consider a simple application that greets the user with the name passed through the parameter <code>name</code> in the URL.
<code>https://example.com/greet?name=John</code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;</span>Hello John!<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;</span>
</code></pre></div><p>Without changing the user input in any way, an attacker might give the following input:</p><p><code>https://example.com/greet?name=&lt;script>alert(1)&lt;/script></code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;</span>Hello <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#000>alert</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)&lt;/</span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>&gt;</span>!<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;</span>
</code></pre></div><p>The attacker now has control to the JavaScript code using a parameter stored in the URL.</p><h3 id=stored-xss>Stored XSS</h3><p>Stored XSS or persistent XSS happens when user input is stored in the database and it is used non-sanitized in the response HTML pages.</p><p><img src=../05-injection-2/support/persistent-xss.png alt="Persistent XSS Steps"></p><p><img src=../05-injection-2/support/XSS_stored.gif alt="Stored XXS Steps"></p><ol><li>The attacker uses one of the website&rsquo;s forms to insert a malicious string into the website&rsquo;s database.</li><li>The victim requests a page from the website.</li><li>The website includes the malicious string from the database in the response and sends it to the victim.</li><li>The victim&rsquo;s browser executes the malicious script inside the response, sending the victim&rsquo;s cookies to the attacker&rsquo;s server.</li></ol><h4 id=example-1>Example</h4><p>A simple example would be an online shop with a review system that would let customers to write text/comments about the products.
One might use it to say <code>"This product is great! I recommend it!"</code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;</span>This product is great! I recommend it!<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;</span>
</code></pre></div><p>But an attacker might use it to send <code>"&lt;script>alert(1)&lt;/script>"</code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;&lt;</span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#000>alert</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)&lt;/</span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>&gt;&lt;/</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;</span>
</code></pre></div><p>The difference between this example and the one at Reflected XSS is that the attacker uses a request to send the review that will be stored in the database of the server. Later on, when another user accesses the product page, the code behind the website will get from the database all reviews associated with the product and insert them in the HTML response page.</p><h3 id=dom-xss>DOM XSS</h3><p>DOM vulnerabilities usually arise when JavaScript code uses data from the user to construct the DOM / HTML page.</p><p><img src=../05-injection-2/support/dom-based-xss.png alt="DOM XSS Steps">
<img src=../05-injection-2/support/XSS_dom.gif alt="XSS DOM Steps"></p><ol><li>The attacker crafts a URL containing a malicious string and sends it to the victim.</li><li>The victim is tricked by the attacker into requesting the URL from the website.</li><li>The website receives the request, but does not include the malicious string in the response.</li><li>The victim&rsquo;s browser executes the legitimate script inside the response, causing the malicious script to be inserted into the page.</li><li>The victim&rsquo;s browser executes the malicious script inserted into the page, sending the victim&rsquo;s cookies to the attacker&rsquo;s server.</li></ol><h4 id=example-2>Example</h4><p>Suppose the following code is used to create a form to let the user choose his/her preferred language. A default language is also provided in the query string, as the parameter “default”.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>Select your language:

<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>select</span><span style=color:#000;font-weight:700>&gt;&lt;</span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>&gt;</span>

<span style=color:#204a87>document</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>write</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&lt;OPTION value=1&gt;&#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#204a87>document</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>location</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>href</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>substring</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>document</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>location</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>href</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>indexOf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;default=&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#4e9a06>&#34;&lt;/OPTION&gt;&#34;</span><span style=color:#000;font-weight:700>);</span>

<span style=color:#204a87>document</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>write</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&lt;OPTION value=2&gt;English&lt;/OPTION&gt;&#34;</span><span style=color:#000;font-weight:700>);</span>

<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>&gt;&lt;/</span><span style=color:#204a87;font-weight:700>select</span><span style=color:#000;font-weight:700>&gt;</span>
</code></pre></div><p>The page is invoked with a URL such as:</p><p><code>https://example.com/page.html?default=French</code></p><p>A DOM Based XSS attack against this page can be accomplished by sending the following URL to a victim:</p><p><code>https://example.com/page.html?default=&lt;script>alert(1)&lt;/script></code></p><h2 id=note>Note</h2><p>The three types of XSS presented above are the ones that historically speaking were categorised, but in order to do a categorization a criteria is needed. The types above have no criteria on which they are sepparated, so let&rsquo;s split XSS vulnerabilities by the place where data is used:</p><ul><li>Server XSS</li><li>Client XSS</li></ul><p>By doing so, the three types above mentioned will look like this:
<img src=../05-injection-2/support/server-client-xss.png alt="Server vs Client XSS"></p><h2 id=defense-mechanisms>Defense Mechanisms</h2><ol><li><strong>Filter input on arrival.</strong> At the point where user input is received, filter as strictly as possible based on what is expected or valid input.</li><li><strong>Encode data on output.</strong> At the point where user-controllable data is output in HTTP responses, encode the output to prevent it from being interpreted as active content. Depending on the output context, this might require applying combinations of HTML, URL, JavaScript, and CSS encoding.</li><li><strong>Use appropriate response headers.</strong> To prevent XSS in HTTP responses that aren&rsquo;t intended to contain any HTML or JavaScript, you can use the <code>Content-Type</code> and <code>X-Content-Type-Options</code> headers to ensure that browsers interpret the responses in the way you intend.</li><li><strong>Content Security Policy.</strong> Use Content Security Policy (CSP) to reduce the severity of any XSS vulnerabilities that still occur.</li><li><strong>Continuous database scanning.</strong> For stored XSS is common practice to scan the database at regulated intervals, although XSS payloads can be written in multiple formats (base64, binary etc.).</li></ol><h2 id=other-xss>Other XSS</h2><h3 id=self-xss>Self XSS</h3><p>Self XSS is a social engineering attack used to gain access to victim&rsquo;s web accounts. The victim is tricked into running malicious JavaScript code into their own browser, in web developer console, which can either exfiltrate data or perform actions on behalf of the user.
This is not a code injection vulnerability as each website is vulnerable to this type of attack. In order to prevent this, websites add warning messages in console. In the image below, there are two examples, from Google Meet and Facebook.</p><p><img src=../05-injection-2/support/self-xss.png alt="Self XSS"></p><h3 id=mutated-xss>Mutated XSS</h3><p>Mutated XSS happens when the browser tries to fix and rewrite invaild HTML but fails doing so thus executing attacker&rsquo;s code. Because it depends from browser to browser, is extremely hard to detect or sanitize within the websites application logic. At the end of this page you will find a video explaining a mXSS on Google Search, and also check the link for one of the first papers describing mXSS attacks.</p><h2 id=challenges>Challenges</h2><h3 id=1-dvwa>1. DVWA</h3><p>We will use Damn Vulnerable Web Application (DVWA) for this one. You may install it however you want, just to work, but a simple way to do it is by using Docker. Once you <a href=https://docs.docker.com/engine/install/>installed</a> docker you must run</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ docker run --rm -it -p 8080:80 vulnerables/web-dvwa
</code></pre></div><p>To access the app, go to http://localhost:8080/setup.php and click on <code>Create/Reset Database</code>. Login with username <code>admin</code> and password <code>password</code>.</p><p>DVWA has multipe vulnerable components, but today we will use the XSS related ones. The app has 4 levels of security that can be changed from &lsquo;DVWA Security&rsquo; section.
All the DVWA challenges allow you to view the PHP source of the page to get additional info about the back-end script. However, in a real-world scenario you won&rsquo;t have that kind of access, so please use this functionality only after you have finished the challenge.</p><p>The goal of this challenges is to rise an <code>alert(1)</code> from JavaScript like this:
<img src=../05-injection-2/support/dvwa-alert-1.png alt="DVWA Alert 1"></p><p>With the security level set on <strong>low</strong> you will have to go through each XSS type. Raise the alert, then change the security level to <strong>medium</strong> and then <strong>high</strong>. After you are done with this, change on <strong>impossible</strong> and click on <code>View Source</code>. Why an exploit is not possible in this case? Check the PHP documentation to understand why.</p><p>Go thgough each on in the following order: Reflected, Stored, DOM</p><h3 id=2-xss-challenges>2. XSS Challenges</h3><p>You have 6 levels to finish here: <a href=https://xss-game.appspot.com/>https://xss-game.appspot.com/</a></p><h3 id=3-even-more-xss-challenges>3. Even more XSS Challenges</h3><p><a href=https://alf.nu/alert1>https://alf.nu/alert1</a></p><h3 id=4-if-you-get-here>4. If you get here</h3><p><a href=http://prompt.ml/0>http://prompt.ml/0</a></p><p><a href=https://xss-quiz.int21h.jp/>https://xss-quiz.int21h.jp/</a></p><p><a href=http://sudo.co.il/xss/>http://sudo.co.il/xss/</a></p><p>Those should be enough to suck the soul out of you.</p><h2 id=further-reading>Further reading</h2><ul><li><a href=https://owasp.org/www-community/attacks/xss/>https://owasp.org/www-community/attacks/xss/</a></li><li><a href=https://portswigger.net/web-security/cross-site-scripting>https://portswigger.net/web-security/cross-site-scripting</a></li><li><a href=https://pentest-tools.com/blog/xss-attacks-practical-scenarios/>5 Practical Scenarios for XSS Attacks</a></li><li><a href=http://www.xss-payloads.com/payloads.html>XSS Exploit Payloads</a></li><li><a href=https://portswigger.net/web-security/cross-site-scripting/cheat-sheet>XSS Cheat Sheet 1</a></li><li><a href=https://owasp.org/www-community/xss-filter-evasion-cheatsheet>XSS Cheat Sheet 2</a></li><li><a href="https://www.youtube.com/watch?v=lG7U3fuNw3A">Mutated XSS on Google Search</a></li><li><a href=https://cure53.de/fp170.pdf>mXSS paper</a></li></ul><hr><h1 id=cross-site-request-forgery-csrf>Cross-Site Request Forgery (CSRF)</h1><h2 id=intro-1>Intro</h2><p>Cross-site request forgery is a vulnerability in web applications that allows an attacker to trick users into performing actions that they did not intend.</p><h2 id=impact-1>Impact</h2><p>Once again, the impact of the vulnerability is linked with the functionality that the web application provides, but it can range from posting a comment on behalf of the user with an outdated 2008 meme to making payments to attacker&rsquo;s wallet to full account takeover.</p><h2 id=how-does-it-work>How does it work?</h2><p>For a CSRF attack to be possible, three key conditions must be in place:</p><ul><li><strong>A relevant action.</strong> There is an action within the application that the attacker has a reason to induce. This might be a privileged action (such as modifying permissions for other users) or any action on user-specific data (such as changing the user&rsquo;s own password).</li><li><strong>Cookie-based session handling.</strong> Performing the action involves issuing one or more HTTP requests, and the application relies solely on session cookies to identify the user who has made the requests. There is no other mechanism in place for tracking sessions or validating user requests.</li><li><strong>No unpredictable request parameters.</strong> The requests that perform the action do not contain any parameters whose values the attacker cannot determine or guess. For example, when causing a user to change their password, the function is not vulnerable if an attacker needs to know the value of the existing password.</li></ul><p>For example, suppose an application contains a function that lets the user change the email address on their account. When a user performs this action, they make an HTTP request like the following:</p><pre><code>POST /email/change HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 30
Cookie: session=yvthwsztyeQkAPzeQ5gHgTvlyxHfsAfE

email=wiener@normal-user.com
</code></pre><p>This meets the conditions required for CSRF:</p><ul><li>The action of changing the email address on a user&rsquo;s account is of interest to an attacker. Following this action, the attacker will typically be able to trigger a password reset and take full control of the user&rsquo;s account.</li><li>The application uses a session cookie to identify which user issued the request. There are no other tokens or mechanisms in place to track user sessions.</li><li>The attacker can easily determine the values of the request parameters that are needed to perform the action.</li></ul><p>With these conditions in place, the attacker can construct a web page containing the following HTML:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>html</span><span style=color:#000;font-weight:700>&gt;</span>
  <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>&gt;</span>
    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>action</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;https://vulnerable-website.com/email/change&#34;</span> <span style=color:#c4a000>method</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;POST&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
      <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hidden&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;email&#34;</span> <span style=color:#c4a000>value</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;pwned@evil-user.net&#34;</span> <span style=color:#000;font-weight:700>/&gt;</span>
    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>&gt;</span>
    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>&gt;</span>
      <span style=color:#204a87>document</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>forms</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>].</span><span style=color:#000>submit</span><span style=color:#000;font-weight:700>();</span>
    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>&gt;</span>
  <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>&gt;</span>
<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>html</span><span style=color:#000;font-weight:700>&gt;</span>
</code></pre></div><h2 id=prevention>Prevention</h2><ul><li>Use SameSite cookie attribute (similar to HTTPOnly and Secure)</li><li>Add a CSRF token for each request that changes the state of the application (e.g. changing password, sending messages) and validate it on backend</li><li>Use user interaction based CSRF defense for sensitive actions such as changing credentials: re-authentication, one-time token, captcha</li><li>Use Cross-origin resource sharing (CORS) headers to prevent CSRF from your website</li><li>GET methods should not change the state of the application. Use appropriate HTTP methods for their intention.</li><li>in-depth list <a href=https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html>here</a></li></ul><p>If you find an action/request to have a CSRF token don&rsquo;t give up to that so easily, there are a number of ways that improper validation of the token will still result in a CSRF vulnerability:</p><ul><li>Validation of CSRF token depends on request method</li><li>Validation of CSRF token depends on token being present</li><li>CSRF token is not tied to the user session</li><li>CSRF token is tied to a non-session cookie</li><li>CSRF token is simply duplicated in a cookie</li></ul><h2 id=note-1>Note</h2><p>You can combine XSS with CSRF :). If you have two websites that share a part of their user base, you can use a XSS vulnerability in one to abuse a CSRF vulnerability in the other one. For example if a company provides two related services (e.g. email and calendar) you can assume that there is a high probability that a user might have accounts on both of the services, making a Stored XSS in one app a great way to exploit a CSRF in the other one.</p><h2 id=challenges-1>Challenges</h2><h3 id=1-dvwa-1>1. DVWA</h3><p>Using the same setup as for XSS challenges, go to the CSRF page of DVWA and craft URLs that will change the password for the user accessing it for each security level: <strong>low</strong>, <strong>medium</strong>, <strong>hard</strong>. Why a CSRF is not possible for <strong>impossible</strong>?</p><h3 id=2-portswigger-academy>2. PortSwigger Academy</h3><p>You have 8 challenges here: <a href=https://portswigger.net/web-security/all-labs#cross-site-request-forgery-csrf>https://portswigger.net/web-security/all-labs#cross-site-request-forgery-csrf</a></p><h2 id=further-reading-1>Further reading</h2><ul><li><a href=https://portswigger.net/web-security/csrf>https://portswigger.net/web-security/csrf</a></li><li><a href=https://owasp.org/www-community/attacks/csrf>https://owasp.org/www-community/attacks/csrf</a></li><li><a href=https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html>CSRF Prevention Cheat Sheet</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3c989ecc31723db021aeba7cbe908787>7 -</h1><p>http connections are plain text</p><p>attackers controlling the middleboxes can intercept traffic (man-in-the-middle, MitM attack)</p><p>information on MitM: <a href=https://www.thesslstore.com/blog/man-in-the-middle-attack-2/,>https://www.thesslstore.com/blog/man-in-the-middle-attack-2/,</a> <a href=https://charlesreid1.com/wiki/Man_in_the_Middle,>https://charlesreid1.com/wiki/Man_in_the_Middle,</a> <a href=https://charlesreid1.com/wiki/Man_in_the_Middle/HTTPS>https://charlesreid1.com/wiki/Man_in_the_Middle/HTTPS</a></p><p>connections need to be security: confidentiality and integrity</p><p>confidentiality: encryption and identity</p><p>TLS: certificates (identity) + encryption (confidentiality)</p><p>certificates: identity + symmetric key generation for encryption</p><p>SSL1.0, SSL2.0, SSL3.0, TLS1.0, TLS1.1, TLS1.2, TLS1.3: <a href=https://maulwuff.de/research/ssl-debugging.html>https://maulwuff.de/research/ssl-debugging.html</a></p><p>use wget + https (google.com)</p><p>save certificate</p><p>use <code>openssl s_client</code></p><p>investigate certificate</p><p>self-signed certificates</p><p>use ssllabs</p><p>certificate internals</p><ul><li>key exchange</li><li>public key algorithm</li><li>ciphers</li></ul><p>issues: <a href=https://www.venafi.com/education-center/ssl/common-ssl-attacks>https://www.venafi.com/education-center/ssl/common-ssl-attacks</a></p><p>HTTP spoofing: client (referal), server-name close, <a href=https://doubleoctopus.com/security-wiki/threats-and-tools/https-spoofing/>https://doubleoctopus.com/security-wiki/threats-and-tools/https-spoofing/</a></p><p>client authentication</p><p>SSL stripping: <a href=https://charlesreid1.com/wiki/SSLStrip,>https://charlesreid1.com/wiki/SSLStrip,</a> <a href=https://www.venafi.com/blog/what-are-ssl-stripping-attacks>https://www.venafi.com/blog/what-are-ssl-stripping-attacks</a></p><p>use SSLSniff: <a href=https://charlesreid1.com/wiki/SSLSniff,>https://charlesreid1.com/wiki/SSLSniff,</a> <a href=https://github.com/moxie0/sslsniff>https://github.com/moxie0/sslsniff</a></p><p>redirection HTTP to HTTPS, issues</p><p>HSTS: <a href=https://https.cio.gov/hsts/,>https://https.cio.gov/hsts/,</a> <a href=https://www.sentinelstand.com/article/http-strict-transport-security-hsts-canonical-www-redirects,>https://www.sentinelstand.com/article/http-strict-transport-security-hsts-canonical-www-redirects,</a> <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security,>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security,</a> <a href=https://security.stackexchange.com/questions/129273/whats-the-difference-between-using-hsts-and-doing-a-301-redirection>https://security.stackexchange.com/questions/129273/whats-the-difference-between-using-hsts-and-doing-a-301-redirection</a></p><p>mitmproxy: <a href=https://mitmproxy.org/,>https://mitmproxy.org/,</a> <a href=https://tools.kali.org/sniffingspoofing/mitmproxy>https://tools.kali.org/sniffingspoofing/mitmproxy</a></p><p>certificate pinning</p><p>TLS / SSL attacks: <a href=https://tools.ietf.org/html/rfc7457,>https://tools.ietf.org/html/rfc7457,</a> <a href=https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/,>https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/,</a> <a href=https://www.cloudinsidr.com/content/known-attack-vectors-against-tls-implementation-vulnerabilities/>https://www.cloudinsidr.com/content/known-attack-vectors-against-tls-implementation-vulnerabilities/</a></p><ul><li>Logjam: <a href=https://weakdh.org/logjam.html>https://weakdh.org/logjam.html</a></li><li>BACKRONYM: <a href=http://backronym.fail/>http://backronym.fail/</a></li><li>DROWN: <a href=https://drownattack.com/>https://drownattack.com/</a></li></ul><p>connection downgrade</p><p>protocol downgrade: <a href=https://www.venafi.com/blog/preventing-downgrade-attacks>https://www.venafi.com/blog/preventing-downgrade-attacks</a></p><p>thc-ssl-dos: <a href=https://tools.kali.org/stress-testing/thc-ssl-dos>https://tools.kali.org/stress-testing/thc-ssl-dos</a></p><p>sslsplit: <a href=https://tools.kali.org/information-gathering/sslsplit>https://tools.kali.org/information-gathering/sslsplit</a></p><p>mitmengine: <a href=https://portswigger.net/daily-swig/sysadmins-offered-new-tools-to-detect-https-interception,>https://portswigger.net/daily-swig/sysadmins-offered-new-tools-to-detect-https-interception,</a> <a href=https://github.com/cloudflare/mitmengine>https://github.com/cloudflare/mitmengine</a></p><p>using stunnel, securing a plain-text connection: <a href=https://www.stunnel.org/>https://www.stunnel.org/</a></p><p>TODO: Create a CA self-signed certificate, create new certificate, sign it with the CA self-signed certificate. See <a href=https://blogg.bekk.no/how-to-sign-a-certificate-request-with-openssl-e046c933d3ae>https://blogg.bekk.no/how-to-sign-a-certificate-request-with-openssl-e046c933d3ae</a></p><p>Resources</p><ul><li><a href=https://tlseminar.github.io/class1/>https://tlseminar.github.io/class1/</a></li></ul><h2 id=commands>Commands</h2><pre><code>razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl s_client -connect www.upb.ro:443 -servername www.upb.ro

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl s_client -connect swarm.cs.pub.ro:443 -servername swarm.cs.pub.ro

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl s_client -connect facebook.com:443 -servername facebook.com

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl x509 -in facebook.crt -noout -text

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl s_client -show-certs -connect facebook.com:443 -servername facebook.com

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl s_client -show_certs -connect facebook.com:443 -servername facebook.com

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl verify -CAfile intermediary.crt facebook.crt

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl verify -CApath /etc/ssl/certs/ intermediary.crt

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl verify -CAfile /etc/ssl/certs/DigiCert_High_Assurance_EV_Root_CA.pem intermediary.crt

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ wget --no-check-certificate security.cs.pub.ro/summer-school/

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ telnet security.cs.pub.ro 80
Trying 141.85.227.114...
Connected to koala.cs.pub.ro.
Escape character is '^]'.
GET / HTTP/1.0

HTTP/1.1 200 OK
[...]

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ telnet 141.85.227.114 80
Trying 141.85.227.114...
Connected to 141.85.227.114.
Escape character is '^]'.
GET / HTTP/1.1
Host: security.cs.pub.ro

[...]

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl x509 -in local/ssl.crt/awesome-ca.com.crt -noout -text

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl genrsa -out local/ssl.key/bucuresti.ro.key 4096

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl rsa -in local/ssl.key/bucuresti.ro.key -noout -text

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl req -new -key local/ssl.key/bucuresti.ro.key -out local/ssl.csr/bucuresti.ro.csr

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl req -noout -text -in local/ssl.csr/bucuresti.ro.csr

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ cat local/ca.conf 
[ ca ]
default_ca = ca_default
[ ca_default ]
dir = ./local/
certs = $dir
new_certs_dir = $dir/ssl.crt
database = $dir/ca.db.index
serial = $dir/ca.db.serial
RANDFILE = $dir/ca.db.rand
certificate = $dir/ssl.crt/awesome-ca.com.crt
private_key = $dir/ssl.key/awesome-ca.com.key
default_days = 365
default_crl_days = 30
default_md = sha256
preserve = no
policy = generic_policy
[ generic_policy ]
countryName = optional
stateOrProvinceName = optional
localityName = optional
organizationName = optional
organizationalUnitName = optional
commonName = optional
emailAddress = optional

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ echo &quot;1234&quot; &gt; local/ca.db.serial
razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ touch local/ca.db.index

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl ca -config local/ca.conf -out local/ssl.crt/bucuresti.ro.crt -infiles local/ssl.csr/bucuresti.ro.csr
Using configuration from local/ca.conf
Check that the request matches the signature
Signature ok
The Subject's Distinguished Name is as follows
countryName           :PRINTABLE:'RO'
stateOrProvinceName   :ASN.1 12:'Bucharest'
organizationName      :ASN.1 12:'Internet Widgits Pty Ltd'
commonName            :ASN.1 12:'bucuresti.ro'
Certificate is to be certified until Jul 16 15:19:40 2021 GMT (365 days)
Sign the certificate? [y/n]:y


1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl x509 -noout -text -in local/ssl.crt/bucuresti.ro.crt

razvan@yggdrasil:~/.../admin/admin.git/certs-ssl$ openssl verify -CAfile local/ssl.crt/awesome-ca.com.crt local/ssl.crt/bucuresti.ro.crt 
local/ssl.crt/bucuresti.ro.crt: OK
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-9487404c736db9fa8f9337d1c0a562ec>8 -</h1><h2 id=introduction>Introduction</h2><p>When performing an attack on a target, the last step of a malicious actor, before achieving full system compromise, is to elevate his or her privileges to an administrative account. Once the attacker reached this phase and successully escalated his access rights, he can do anything with the vulnerable application or computer system.</p><h2 id=what-is-privilege-escalation>What is privilege escalation?</h2><p>Privilege escalation vulnerabilities are security issues that allow users to gain more permissions and a higher level of access to systems or applications than their administrators intended. These types of flaws are valuable for attackers because they&rsquo;re needed for full exploit chains but can be overlooked by defenders or developers because of their lower severity scores.</p><p>In general, any violation of an intentional security boundary can be considered a privilege escalation issue, including gaining kernel access from a user application in an operating system, escaping a virtual machine to access the underlying hypervisor, gaining domain administrator access from a workstation, or gaining privileged roles in public web applications by exploiting misconfigurations.</p><p>There are two main types of privilege escalation:</p><ol><li><strong>Horizontal Privilege Escalation</strong> is when a user gains the access rights of another user who has the same access level as he or she does.</li><li><strong>Vertical Privilege Escalation</strong> is when an attacker uses a flaw in the system to gain access above what was intended for him or her.</li></ol><h3 id=horizontal-privilege-escalation>Horizontal Privilege Escalation</h3><p>Gaining access to a user account with the same level of privileges as the malicious actor might sound a little weird, but there are legitimate use-cases for this. Think about the following scenario:</p><blockquote><p>Bob and Alice both have their own accounts at the same bank. Bob has malicious intents and exploits a misconfiguration to gain access to Alice&rsquo;s account. Even though they have the same level of access to the application&rsquo;s functionality, Bob can now access Alice&rsquo;s personal information, and is able to alter her account, transfer money on her behalf and many other things.</p></blockquote><h3 id=vertical-privilege-escalation>Vertical Privilege Escalation</h3><p>Generally, when someone attempts to hack into a system, it’s because they want to perform some action on the system. This could be damaging the system or stealing information. Oftentimes, this requires a privilege level the attacker does not possess. This is where vertical privilege escalation comes in.</p><p>The attacker exploits a flaw in the system, abuses a misconfiguration, or uses another vector to elevate his privileges from a normal user to an administrator.</p><p>Once the attacker managed to elevate his access rights, he will be able to perform any action the compromised account was able to perform.</p><p>An actual scenario to better understand the potential damage:</p><blockquote><p>The attacker managed to capture the admin&rsquo;s session cookies and takes over his session. Once logged in using the admin&rsquo;s cookies, he has access to the administration panel of the web application. From here, he can steal sensitive information (such as users data), perform a Denial of Service (DoS) attack (by deleting website&rsquo;s data), and create persistence (by locking out the actual administrators of the website).</p></blockquote><h2 id=application-vs-system-privesc>Application vs System PrivEsc</h2><p>In the context of Web Security, we can also speak of another way of categorizing privilege escalation:</p><ol><li><strong>Application Privilege Escalation</strong> is when the attacker uses the application accounts to gain further access to application functionality.</li><li><strong>System Privilege Escalation</strong> is when the attacker has already gained access to the underlying system where the web application runs and wishes to elevate his privileges to the administrator&rsquo;s account of the server.</li></ol><p>We have already given a few examples of application privilege escalations in thre previous section, so now we will focus on system privilege escalation.</p><h3 id=system-privilege-escalation>System Privilege Escalation</h3><p>Security best practices suggest a very useful principle, called the <strong>Principle of Least Privilege</strong>, in which a user is given the minimum levels of access – or permissions – needed to perform his/her job functions.</p><p>Following this principle, web servers should always be run by an unprivileged user – say <code>www-data</code> on a Linux system. The reciprocate of this is to <strong>never</strong> run a web server as <code>root</code>. This is <em>very important</em>, as it adds an extra security layer in case the web application is compromised. If that happens, the attacker will have the same privileges on the system as the user running the application.</p><p>Let&rsquo;s say that an attacker managed to find an <strong>RCE vulnerability</strong> (Remote Code Execution) on the web application. If the application is run by <code>root</code>, the attacker will be able to perform any command on the system with the same privileges as <code>root</code>. If, however, the application is run as <code>www-data</code>, the attacker will only have access to a small part of the system and will have to find another vulnerability to elevate his privileges.</p><h2 id=privilege-escalation-vectors>Privilege Escalation Vectors</h2><h3 id=application-vectors>Application Vectors</h3><p>First of all, let&rsquo;s talk about how an attacker could perform a privilege escalation attack on the web application.</p><ol><li><strong>Broken Access Control</strong> - when a user can in fact access some resource or perform some action that they are not supposed to be able to access.</li></ol><blockquote><p><strong>Example:</strong> The web application has an admin panel protected against unauthorized access, but uses API calls to retrieve users and perform actions. The developer forgot to secure these API endpoints with the same protection as the admin panel interface and the attacker discovered them, having unrestricted access to admin commands.</p></blockquote><ol start=2><li><strong>Session Hijacking</strong> - when a user steals another user / administrator session cookies and impersonates him.</li></ol><blockquote><p><strong>Example:</strong> The attacker found an XSS vulnerability / performed a Man in the Middle Attack and stole the session cookie of another user. Now he is able to impersonate that user in any request by using their cookies. If the compromised account is a normal user, it&rsquo;s called horizontal privilege escalation. If it&rsquo;s an administrator account, it&rsquo;s called vertical privilege escalation.</p></blockquote><h3 id=system-vectors>System Vectors</h3><p>Finally, let&rsquo;s analyze a few methods where an attacker could gain elevated privileges once he has a foothold of the system (is able to execute commands on the underlying system).</p><p>There are countless methods to elevate privileges on a Linux system. The key in finding them is to <strong>enumerate</strong> the host for potential vectors.</p><ol><li><strong>Kernel Exploit</strong><ul><li>CVE-2016-5195 (<a href=https://dirtycow.ninja/>DirtyCow</a>) - Linux Kernel &lt;= <code>3.19.0-73.8</code>.
A race condition was found in the way the Linux kernel&rsquo;s memory subsystem handled the copy-on-write (COW) breakage of private read-only memory mappings. An unprivileged local user could use this flaw to gain write access to otherwise read-only memory mappings and thus increase their privileges on the system.</li><li>sudo &lt;= <code>v1.28</code><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&gt; sudo -u#-1 /bin/bash
</code></pre></div><pre><code></code></pre></li><li>More kernel exploits in this Git repos: <a href=https://github.com/lucyoa/kernel-exploits>@lucyoa</a>, <a href=https://github.com/offensive-security/exploitdb-bin-sploits/tree/master/bin-sploits>@offensive-security</a>.</li></ul></li><li><strong>Exploiting SUDO Rights / SUID Binaries</strong><ul><li>Sudo configuration might allow a user to execute some command with another user privileges without knowing the password:<div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&gt; sudo -l
User demo may run the following commands on demo-host:
   <span style=color:#ce5c00;font-weight:700>(</span>root<span style=color:#ce5c00;font-weight:700>)</span> NOPASSWD: /usr/bin/vim
</code></pre></div><pre><code>This would allow the attacker to create a privileged shell:
```bash
&gt; sudo vim -c '!sh'
</code></pre><pre><code></code></pre></li><li>SUID Binaries. SUID/Setuid stands for &ldquo;set user ID upon execution&rdquo;, and it is enabled by default in every Linux distributions. If a file with this bit is ran, the <code>uid</code> will be changed by the owner one. If the file owner is <code>root</code>, the <code>uid</code> will be changed to <code>root</code> even if it was executed from user <code>bob</code>. SUID bit is represented by an <code>s</code>.
Commands to list SUID binaries:<div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&gt; find / -perm -4000 -type f -exec ls -la <span style=color:#ce5c00;font-weight:700>{}</span> 2&gt;/dev/null <span style=color:#4e9a06>\;</span>
&gt; find / -uid <span style=color:#0000cf;font-weight:700>0</span> -perm -4000 -type f 2&gt;/dev/null
</code></pre></div><pre><code></code></pre></li><li><a href=https://gtfobins.github.io/>GTFOBins</a> are a curated list of Unix binaries that can be exploited by an attacker to bypass local security restrictions.</li></ul></li><li><strong>Path Hijacking</strong><ul><li>Path Hijacking occurs when a program uses the relative path to another program instead of the absolute path. Consider the following Python code:<div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>os</span>
<span style=color:#000>os</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>system</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;create_backup&#39;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><pre><code> The `$PATH` variable is a Linux environment variable that specifies where to look for a specific binary when a full path is not provided. An attacker can exploit this mechanism by either being allowed to modify the `$PATH` variable or being able to write files inside directories specified there.
 So, in order to exploit the above Python code, the attacker places a program called `create_backup` inside a location from the `$PATH` variable and Linux will execute the malicious program instead of the intended one.
</code></pre></li></ul></li><li><strong>Docker Privilege Escalation / Container Escape</strong><ul><li>This requires the user to be privileged enough to run docker, i.e. being in the <code>docker</code> group or being <code>root</code>.<div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&gt; docker run -v /:/mnt --rm -it alpine chroot /mnt sh
</code></pre></div><pre><code> The command above creates a new container based on the `Linux Alpine` image, mounts the `/` directory from the host on `/mnt` inside the container and runs it with `/bin/sh`. Now the attacker can read any file on the system.
</code></pre></li><li>Escaping Docker privileged containers. Docker privileged containers are those run with the <code>--privileged</code> flag. Unlike regular containers, these have root privilege to the host machine. A detailed article can be read <a href=https://betterprogramming.pub/escaping-docker-privileged-containers-a7ae7d17f5a1>here</a></li></ul></li><li><strong>Others</strong><ul><li><code>id</code> / <code>whoami</code> - identify if the user is part of special groups, such as <code>docker</code>, <code>admin</code>, etc.</li><li><code>cat /etc/passwd</code> - list system users for potential privilege escalation</li><li><code>crontab -l</code> / <code>ls -al /etc/cron* /etc/at*</code> - enumerate cron jobs (scheduled jobs) on the system.</li><li><code>ps aux</code> / <code>ps -ef</code> - inspect running processes</li><li><code>find / -name authorized_keys 2> /dev/null</code> - find SSH authorized keys</li><li><code>find / -name id_rsa 2> /dev/null</code> - find SSH private keys</li><li><code>find / -type f -iname ".*" -ls 2>/dev/null</code> - find hidden files</li><li><code>grep --color=auto -rnw '/' -ie "PASSWORD" --color=always 2> /dev/null</code> - find files containing passwords.</li><li>Manually looking through web server logs, such as access or error logs for any sensitive information. Default locations for these logs:<ul><li><code>/var/log/apache2/error.log</code></li><li><code>/var/log/apache/access.log</code></li><li><code>/var/log/apache2/access.log</code></li><li><code>/etc/httpd/logs/access_log</code></li></ul></li></ul></li></ol><h3 id=tools>Tools</h3><p>There are many tools that automated the process of enumeration and could help you save a lot of time when looking for privilege escalation vectors. The best tool for Linux is <a href=https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS>LinPEAS</a>.</p><h2 id=preventing-privilege-escalation>Preventing Privilege Escalation</h2><p>When it comes to OS-level privilege escalation vulnerabilities, it&rsquo;s vital to install security patches as soon as possible, not only for the OS, but for all third-party applications used on the system.</p><p>Application whitelisting technologies can be used to restrict which programs may run on a system, enabling organizations to reduce a machine&rsquo;s attack surface. Making sure that unneeded services are turned off and that unused hardware components and drivers are disabled is also very important.</p><h2 id=further-reading>Further reading</h2><ul><li><a href=https://www.csoonline.com/article/3564726/privilege-escalation-explained-why-these-flaws-are-so-valuable-to-hackers.html>https://www.csoonline.com/article/3564726/privilege-escalation-explained-why-these-flaws-are-so-valuable-to-hackers.html</a></li><li><a href=https://portswigger.net/web-security/access-control>https://portswigger.net/web-security/access-control</a></li><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md>https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md</a></li><li><a href=https://book.hacktricks.xyz/linux-unix/privilege-escalation>https://book.hacktricks.xyz/linux-unix/privilege-escalation</a></li><li><a href=https://dirtycow.ninja/>https://dirtycow.ninja/</a></li><li><a href=https://github.com/lucyoa/kernel-exploits>https://github.com/lucyoa/kernel-exploits</a></li><li><a href=https://github.com/offensive-security/exploitdb-bin-sploits/tree/master/bin-sploits>https://github.com/offensive-security/exploitdb-bin-sploits/tree/master/bin-sploits</a></li><li><a href=https://gtfobins.github.io/>https://gtfobins.github.io/</a></li><li><a href=https://betterprogramming.pub/escaping-docker-privileged-containers-a7ae7d17f5a1>https://betterprogramming.pub/escaping-docker-privileged-containers-a7ae7d17f5a1</a></li><li><a href=https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS>https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS</a></li><li><a href=https://app.hackthebox.eu/machines>https://app.hackthebox.eu/machines</a></li></ul><h2 id=challenges>Challenges</h2><ul><li>Escalation</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f03e24906eb542d936ae967261b84e88>9 -</h1><p>Session 10 content</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel=noopener href=https://bit.ly/DiscordSecuritySummerSchool aria-label=Discord><i class="fab fa-discord"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Facebook aria-label=Facebook><a class=text-white target=_blank rel=noopener href=https://www.facebook.com/SSSUPB/ aria-label=Facebook><i class="fab fa-facebook"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank rel=noopener href=https://bit.ly/YoutubeSecuritySummerSchool aria-label=Youtube><i class="fab fa-youtube"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/security-summer-school aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 Open-Source Contributors. All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>